<!DOCTYPE html><html><head><meta name="viewport" content="width=device-width"/><meta charSet="utf-8"/><link rel="icon shortcut" type="image/png" href="https://blog.ubie.tech/logo.png"/><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700&amp;display=swap"/><title>kamina_zzz | Ubie Engineers&#x27; Blogs</title><meta property="og:title" content="kamina_zzz"/><meta property="og:url" content="https://blog.ubie.tech/members/kamina_zzz"/><meta name="twitter:card" content="summary_large_image"/><meta property="og:site" content="Ubie Engineers&#x27; Blogs"/><meta property="og:image" content="https://blog.ubie.tech/og.png"/><link rel="canonical" href="https://blog.ubie.tech/members/kamina_zzz"/><link rel="preload" href="/_next/static/css/022fee67b0af59aa852d.css" as="style"/><link rel="stylesheet" href="/_next/static/css/022fee67b0af59aa852d.css" data-n-g=""/><noscript data-n-css="true"></noscript><link rel="preload" href="/_next/static/chunks/main-8a83f0fd99327c4684a8.js" as="script"/><link rel="preload" href="/_next/static/chunks/webpack-e067438c4cf4ef2ef178.js" as="script"/><link rel="preload" href="/_next/static/chunks/framework.1daf1ec1ecf144ee9147.js" as="script"/><link rel="preload" href="/_next/static/chunks/commons.8d61253ae98ee51657b8.js" as="script"/><link rel="preload" href="/_next/static/chunks/pages/_app-e552cec615d644762a9b.js" as="script"/><link rel="preload" href="/_next/static/chunks/81b50c7ab23905e464b4340eb234bd6ea389d26b.08e7af43e0a5a53b335f.js" as="script"/><link rel="preload" href="/_next/static/chunks/pages/members/%5Bid%5D-0a2d3cf0d329b39cefc0.js" as="script"/></head><body><div id="__next"><header class="site-header"><div class="content-wrapper"><div class="site-header__inner"><a class="site-header__logo-link" href="/"><img src="/logo.png" alt="Ubie Engineers&#x27; Blogs" class="site-header__logo-img"/><span class="site-header__logo-text">Ubie<br/>Engineers&#x27; Blogs</span></a><div class="site-header__links"><a href="https://ubie.life/" class="site-header__link" target="_blank">Company</a><a href="https://recruit.ubie.life/jd_dev" class="site-header__link" target="_blank">Recruit</a></div></div></div></header><section class="member"><div class="content-wrapper"><header class="member-header"><figure class="member-header__avatar"><img src="/avatars/kamina_zzz.jpg" alt="kamina_zzz" width="200" height="200" class="member-header__avatar-img"/></figure><h1 class="member-header__nickname">kamina_zzz</h1><p class="member-header__real-name">Kaito Minatoya</p><p class="member-header__bio">Sake Reliability Engineer</p><div class="member-header__links"><a href="https://twitter.com/kamina_zzz" class="member-header__link"><img src="/icons/twitter.svg" alt="Twitterのユーザー@kamina_zzz" width="22" height="22"/></a><a href="https://y.at/🍺🤘🎧🤘🍺" class="member-header__link"><img src="/icons/link.svg" alt="ウェブサイトのリンク" width="22" height="22"/></a></div></header><div class="member-posts-container"><div class="post-list"><article class="post-link"><a class="post-link__author" href="/members/kamina_zzz/"><img src="/avatars/kamina_zzz.jpg" class="post-link__author-img" width="35" height="35"/><div class="post-link__author-name"><div class="post-link__author-name">kamina_zzz</div><time dateTime="2021-04-28T03:20:12.000Z" class="post-link__date">10 months ago</time></div></a><a href="https://zenn.dev/kamina_zzz/articles/b99d5822a55bac" class="post-link__main-link"><h2 class="post-link__title">GKE はどのようにログを収集しているのか</h2><div class="post-link__site"><img src="https://www.google.com/s2/favicons?domain=zenn.dev" width="14" height="14" class="post-link__site-favicon"/>zenn.dev</div></a></article><article class="post-link"><a class="post-link__author" href="/members/kamina_zzz/"><img src="/avatars/kamina_zzz.jpg" class="post-link__author-img" width="35" height="35"/><div class="post-link__author-name"><div class="post-link__author-name">kamina_zzz</div><time dateTime="2021-02-01T07:04:27.000Z" class="post-link__date">a year ago</time></div></a><a href="https://zenn.dev/kamina_zzz/articles/e9d68da8a88cf2" class="post-link__main-link"><h2 class="post-link__title">Go 製 CLI ツールにおける selfupdate の実装</h2><div class="post-link__site"><img src="https://www.google.com/s2/favicons?domain=zenn.dev" width="14" height="14" class="post-link__site-favicon"/>zenn.dev</div></a></article><article class="post-link"><a class="post-link__author" href="/members/kamina_zzz/"><img src="/avatars/kamina_zzz.jpg" class="post-link__author-img" width="35" height="35"/><div class="post-link__author-name"><div class="post-link__author-name">kamina_zzz</div><time dateTime="2020-12-03T10:33:01.000Z" class="post-link__date">a year ago</time></div></a><a href="https://note.com/kamina_zzz/n/ne60e798479e4" class="post-link__main-link"><h2 class="post-link__title">ソフトウェアエンジニアが楽しめて気持良く働ける桃源郷を探せ！</h2><div class="post-link__site"><img src="https://www.google.com/s2/favicons?domain=note.com" width="14" height="14" class="post-link__site-favicon"/>note.com</div></a></article><article class="post-link"><a class="post-link__author" href="/members/kamina_zzz/"><img src="/avatars/kamina_zzz.jpg" class="post-link__author-img" width="35" height="35"/><div class="post-link__author-name"><div class="post-link__author-name">kamina_zzz</div><time dateTime="2019-12-06T09:39:05.000Z" class="post-link__date">2 years ago</time></div></a><a href="https://qiita.com/kamina_zzz/items/b5eedfe4a34c8d01d5f6" class="post-link__main-link"><h2 class="post-link__title">地球上の Kubernetes ユーザーは絶対使うべきツールたちを紹介するよ</h2><div class="post-link__site"><img src="https://www.google.com/s2/favicons?domain=qiita.com" width="14" height="14" class="post-link__site-favicon"/>qiita.com</div></a></article><article class="post-link"><a class="post-link__author" href="/members/kamina_zzz/"><img src="/avatars/kamina_zzz.jpg" class="post-link__author-img" width="35" height="35"/><div class="post-link__author-name"><div class="post-link__author-name">kamina_zzz</div><time dateTime="2018-12-25T08:47:12.000Z" class="post-link__date">3 years ago</time></div></a><a href="https://qiita.com/kamina_zzz/items/0540f663832e07ee1b10" class="post-link__main-link"><h2 class="post-link__title">Ruby におけるメモリの話</h2><div class="post-link__site"><img src="https://www.google.com/s2/favicons?domain=qiita.com" width="14" height="14" class="post-link__site-favicon"/>qiita.com</div></a></article><article class="post-link"><a class="post-link__author" href="/members/kamina_zzz/"><img src="/avatars/kamina_zzz.jpg" class="post-link__author-img" width="35" height="35"/><div class="post-link__author-name"><div class="post-link__author-name">kamina_zzz</div><time dateTime="2018-12-17T10:38:55.000Z" class="post-link__date">3 years ago</time></div></a><a href="https://qiita.com/kamina_zzz/items/5f231391733b28250088" class="post-link__main-link"><h2 class="post-link__title">入門 Rancher v2</h2><div class="post-link__site"><img src="https://www.google.com/s2/favicons?domain=qiita.com" width="14" height="14" class="post-link__site-favicon"/>qiita.com</div></a></article><article class="post-link"><a class="post-link__author" href="/members/kamina_zzz/"><img src="/avatars/kamina_zzz.jpg" class="post-link__author-img" width="35" height="35"/><div class="post-link__author-name"><div class="post-link__author-name">kamina_zzz</div><time dateTime="2018-11-30T03:05:51.000Z" class="post-link__date">3 years ago</time></div></a><a href="https://qiita.com/kamina_zzz/items/58d831c7b238fb4b409c" class="post-link__main-link"><h2 class="post-link__title">最強GPUを自由に触れる食べログの開発環境を紹介するよ</h2><div class="post-link__site"><img src="https://www.google.com/s2/favicons?domain=qiita.com" width="14" height="14" class="post-link__site-favicon"/>qiita.com</div></a></article><article class="post-link"><a class="post-link__author" href="/members/kamina_zzz/"><img src="/avatars/kamina_zzz.jpg" class="post-link__author-img" width="35" height="35"/><div class="post-link__author-name"><div class="post-link__author-name">kamina_zzz</div><time dateTime="2018-11-15T05:02:35.000Z" class="post-link__date">3 years ago</time></div></a><a href="https://qiita.com/kamina_zzz/items/7ef09ea27da38c6db9db" class="post-link__main-link"><h2 class="post-link__title">Go の Revel フレームワークでタイムゾーンを設定する</h2><div class="post-link__site"><img src="https://www.google.com/s2/favicons?domain=qiita.com" width="14" height="14" class="post-link__site-favicon"/>qiita.com</div></a></article><article class="post-link"><a class="post-link__author" href="/members/kamina_zzz/"><img src="/avatars/kamina_zzz.jpg" class="post-link__author-img" width="35" height="35"/><div class="post-link__author-name"><div class="post-link__author-name">kamina_zzz</div><time dateTime="2016-06-12T06:49:25.000Z" class="post-link__date">6 years ago</time></div></a><a href="https://qiita.com/kamina_zzz/items/f4a441d833e7b03930a8" class="post-link__main-link"><h2 class="post-link__title">RをMacOS Xにbrewでインストールするとちょっとハマる、ということ</h2><div class="post-link__site"><img src="https://www.google.com/s2/favicons?domain=qiita.com" width="14" height="14" class="post-link__site-favicon"/>qiita.com</div></a></article><article class="post-link"><a class="post-link__author" href="/members/kamina_zzz/"><img src="/avatars/kamina_zzz.jpg" class="post-link__author-img" width="35" height="35"/><div class="post-link__author-name"><div class="post-link__author-name">kamina_zzz</div><time dateTime="2016-01-13T18:16:28.000Z" class="post-link__date">6 years ago</time></div></a><a href="https://qiita.com/kamina_zzz/items/732275bd9e107ce1a964" class="post-link__main-link"><h2 class="post-link__title">AWSのGPU有りインスタンスにChainer 1.5を最も簡単にインストールする</h2><div class="post-link__site"><img src="https://www.google.com/s2/favicons?domain=qiita.com" width="14" height="14" class="post-link__site-favicon"/>qiita.com</div></a></article><article class="post-link"><a class="post-link__author" href="/members/kamina_zzz/"><img src="/avatars/kamina_zzz.jpg" class="post-link__author-img" width="35" height="35"/><div class="post-link__author-name"><div class="post-link__author-name">kamina_zzz</div><time dateTime="2015-05-21T09:41:07.000Z" class="post-link__date">7 years ago</time></div></a><a href="https://qiita.com/kamina_zzz/items/29bda444cb800ded1347" class="post-link__main-link"><h2 class="post-link__title">ログインユーザーの環境変数のままsudoする</h2><div class="post-link__site"><img src="https://www.google.com/s2/favicons?domain=qiita.com" width="14" height="14" class="post-link__site-favicon"/>qiita.com</div></a></article><article class="post-link"><a class="post-link__author" href="/members/kamina_zzz/"><img src="/avatars/kamina_zzz.jpg" class="post-link__author-img" width="35" height="35"/><div class="post-link__author-name"><div class="post-link__author-name">kamina_zzz</div><time dateTime="2014-12-18T17:56:22.000Z" class="post-link__date">7 years ago</time></div></a><a href="https://qiita.com/kamina_zzz/items/89ed78ae5e396c34964c" class="post-link__main-link"><h2 class="post-link__title">Windows7でF8キーを使わないセーフモードの起動方法</h2><div class="post-link__site"><img src="https://www.google.com/s2/favicons?domain=qiita.com" width="14" height="14" class="post-link__site-favicon"/>qiita.com</div></a></article><article class="post-link"><a class="post-link__author" href="/members/kamina_zzz/"><img src="/avatars/kamina_zzz.jpg" class="post-link__author-img" width="35" height="35"/><div class="post-link__author-name"><div class="post-link__author-name">kamina_zzz</div><time dateTime="2014-10-16T10:05:33.000Z" class="post-link__date">7 years ago</time></div></a><a href="https://qiita.com/kamina_zzz/items/1544056b165b6ca35d5c" class="post-link__main-link"><h2 class="post-link__title">dotfilesの初期化用スクリプト</h2><div class="post-link__site"><img src="https://www.google.com/s2/favicons?domain=qiita.com" width="14" height="14" class="post-link__site-favicon"/>qiita.com</div></a></article><article class="post-link"><a class="post-link__author" href="/members/kamina_zzz/"><img src="/avatars/kamina_zzz.jpg" class="post-link__author-img" width="35" height="35"/><div class="post-link__author-name"><div class="post-link__author-name">kamina_zzz</div><time dateTime="2014-08-26T07:50:19.000Z" class="post-link__date">8 years ago</time></div></a><a href="https://qiita.com/kamina_zzz/items/4d2f2f12df8512fac889" class="post-link__main-link"><h2 class="post-link__title">Vim初心者がvimrcを育てていく</h2><div class="post-link__site"><img src="https://www.google.com/s2/favicons?domain=qiita.com" width="14" height="14" class="post-link__site-favicon"/>qiita.com</div></a></article></div></div></div></section><footer class="site-footer"><div class="content-wrapper"><p>© <!-- -->Ubie Discovery</p></div></footer></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"member":{"id":"kamina_zzz","nickname":"kamina_zzz","realName":"Kaito Minatoya","bio":"Sake Reliability Engineer","avatarSrc":"/avatars/kamina_zzz.jpg","sources":["https://note.com/kamina_zzz/rss","https://zenn.dev/kamina_zzz/feed","https://qiita.com/kamina_zzz/feed"],"twitterUsername":"kamina_zzz","websiteUrl":"https://y.at/🍺🤘🎧🤘🍺"},"postItems":[{"title":"GKE はどのようにログを収集しているのか","contentSnippet":"Ubie で SRE をしている @kamina_zzz です。Ubie では Kubernetes を GKE で運用しているんですが、GKE だと container の STDOUT がいい感じに Cloud Logging へと集約されていますよね。この経路、以前は Fluentd が使われていたんですが、近年は Fluent Bit が使われています。Fluent Bit になってからどのようにしてログを集約していい感じに Cloud Logging へ送信しているのか気になってしまったので今回はこの辺りをまとめてみます。さしあたって今回使用するバージョンはこんな感じ...","link":"https://zenn.dev/kamina_zzz/articles/b99d5822a55bac","isoDate":"2021-04-28T03:20:12.000Z","dateMiliSeconds":1619580012000,"authorName":"kamina_zzz","authorId":"kamina_zzz"},{"title":"Go 製 CLI ツールにおける selfupdate の実装","contentSnippet":"introどうもこんにちは、@kamina-zzz と申します。初めての zenn で緊張しております。よろしくおねがいします。突然ですが、入社時に「 これをインストールしておけばとりあえず開発できるで！ 」みたいなツールがあると何かと便利ですよね。例えばエンジニアが開発するにあたって必要なツール(例えば kubectl や istioctl とかとか)のインストールとかをやったり認証をしたりデプロイをしたりするのを全部ひとつの CLI ツール経由でやれると嬉しいですよね。ということで今 Ubie では ubiectl という名前の CLI ツールを Go で作っています。...","link":"https://zenn.dev/kamina_zzz/articles/e9d68da8a88cf2","isoDate":"2021-02-01T07:04:27.000Z","dateMiliSeconds":1612163067000,"authorName":"kamina_zzz","authorId":"kamina_zzz"},{"title":"ソフトウェアエンジニアが楽しめて気持良く働ける桃源郷を探せ！","contentSnippet":"はじめまして、Ubie (ユビー)でソフトウェアエンジニア (以下 SWE)として働く @kamina_zzz です。2020年 Ubie アドベントカレンダー3日目 の記事として何を書こうか迷ったんですが、転職エントリも結局書いていなかったし、せっかくなら SWE の働く環境をテーマに転職エントリも兼ねて書いてみようと思います。続きをみる","link":"https://note.com/kamina_zzz/n/ne60e798479e4","isoDate":"2020-12-03T10:33:01.000Z","dateMiliSeconds":1606991581000,"authorName":"kamina_zzz","authorId":"kamina_zzz"},{"title":"地球上の Kubernetes ユーザーは絶対使うべきツールたちを紹介するよ","contentSnippet":"これはなに？これは Ubie アドベントカレンダー 2019 の6日目の記事です。今日は SRE の @kamina_zzz が担当します  こんな方を想定してますKubernetes(k8s) を使っている初心者から玄人までCUI がお好きLazyまた、筆者の環境はこんな感じですので異なる部分は適宜吸収してください  iOSKubernetes v1.14.7はじめにk8s ユーザはみんな一度は使ったことがあるはず、 kubectl コマンド。k8s cluster 内部の状態を見たり操作するOperations, Resource types, Output options を組み合わせてつかうって感じのコマンドなんですが、具体的にはこんな感じで使いますよね。$ kubectl get pods$ kubectl describe deployments my-app-name -n my-app-namespaceみなさん「あぁ、せやな」って感じだと思うんですが、実はこの kubectl 、デフォルトのままだといろいろと不便ですよね？なので今回は Kubernetes 界隈のみんなが使っているツールたち を紹介していきます！ 1※ ちなみに判断基準は概ね GitHub star です。言うほど不便か…？まあそうなんですよね。別に必要なことはできるし。だけど毎日触ってるとこんな気持ちになってくるんです。複数のクラスタを管理してるとクラスタの切り替えを頻繁にやらなきゃだけどめんどくさいコマンドが長いkubectl describe deployments my-app-name -n my-app-namespace って毎回打つの？無理、たすけてnamespace って毎回指定します？ deployments 見て pods 見て、って時に毎回？？キツくない？etc etc...てな感じでもっと便利にできそうなところです。便利にしていこう。krewこの手の話でよくある流れっちゃそうなんですが、例によって kubectl も plugin で好きなようにカスタマイズ することができます。そして krew という名前の、まあ Homebrew の kubectl バージョンみたいなパッケージマネージャがあり、それを使うのが便利です。インストールの手順などは krew の repo を見てもらうとして、こんな感じで使うツールです。試しに kail という LinkedIn の CTO の方が公開しているツールをインストールしてみましょう  $ kubectl krew search$ kubectl krew install tail # krew には tail という名前で公開されているbrew コマンドと同じですね。こうしてインストールすると kubectl のサブコマンドとしてプラグインを実行できます。$ kubectl tail --ns my-app-ns --deploy my-app簡単ですね！これで便利なものをどんどん入れて使いやすくしましょう  kubectx複数クラスタを管理するときの context 切り替えが便利になります。$ kubectl krew install ctx$ kubectl ctx#=\u003e credentials に基づいて選べる context 一覧が表示されるさらに、fzf コマンド がインストールされていると fuzzy/incremental search ができて、 CUI 上で選択して切り替えられるので、めちゃ早くておすすめです  例えば- もともと test context にいる- coffee context へ切り替え- get pods すると coffee のものが表示される- kubectx - で一つ前の test context へ戻る- get pods すると test のものが表示されるというケースではこんな感じに動きます。 2ご覧のように kubectx は plugin としてではなく、普通のツールとして Homebrew 等を経由してインストールできます。そのため上のように公式の README では kubectx コマンドを実行したサンプルが用意されています。kubensnamespace をいちいち指定するの大変ですよね。これは namespace の指定をしなかった場合にデフォルトの namespace を予めセットしてくれるツールです。同様に kubectl krew install ns すると、kubectx と同じように使えるようになります。また、こちらも fzf 対応、単独インストール可能です。例によって default ns -\u003e kube-system ns -\u003e default ns への遷移はこんな感じでできます。2kube-aliasesそもそも kubectl get pods[po] って打つの大変なので alias とか作ろうという気持ちになります。ですが kubectl の特性上、よくやるコマンドは大枠あっても微妙に resource が違ったり output が違ったりして都度 alias を作るのは大変です。これをあるパターンにそってガッと生成してくれたセットを kubectx, kubens と同じ作者の方が公開されています  パターン化されているので alias 自体も覚えやすく、かなり良いです。インストール方法は 公式の README を見てもらうことにしますが、シンプルに alias がたくさん書かれたファイルを bash/zsh の config で読み込むだけです。いくつかの alias を見てみましょう。$ alias k#=\u003e k=kubectl$ alias kgpo#=\u003e kgpo='kubectl get pods'$ alias kddep#=\u003e kddep='kubectl describe deployment'$ alias ka#=\u003e ka='kubectl apply --recursive -f'$ alias krm#=\u003e krm='kubectl delete'これで長々したコマンドはもう打たずに済みそうです  おわりに終わってみればパッケージマネージャをつかって便利にカスタマイズalias 貼ってコマンドの簡素化という、こういうツール系にありがちな流れではありますが、なんだか kubectl 周りについてはあまり知られてないような気がしたので書いてみました。(もしかするとみんな既に知ってるだけの可能性がありますが気にしないことにします。)みなさんも便利そうなプラグインを探してみて下さい  ありがとうございました！筆者の独断です。みんながやってるかは知りません。ごめん。あと別にデフォルトで不満ないならそれで全然良いと思う。 ↩公式 README から拝借 ↩","link":"https://qiita.com/kamina_zzz/items/b5eedfe4a34c8d01d5f6","isoDate":"2019-12-06T09:39:05.000Z","dateMiliSeconds":1575625145000,"authorName":"kamina_zzz","authorId":"kamina_zzz"},{"title":"Ruby におけるメモリの話","contentSnippet":"食べログ AdventCalendar の25 日目 最終日の今日は @kamina_zzz が担当します。クリスマスといえば Ruby の新バージョンということで、まあそれとは全く関係無いんですが Ruby におけるメモリの扱いについて書こうと思います。環境は以下の通りです。Ruby v2.5CRuby (MRI)よろしくおねがいします!オブジェクトとメモリRuby におけるオブジェクトは、 Ruby 内部の C 言語で登場する名前で言うところの VALUE に相当します。オブジェクトはサイズによって内部でメモリの扱いが違うため、まずはそれを説明します。小さいオブジェクトVALUE の定義は以下の通りです。typedef unsigned long VALUE;VALUE は普段はポインタへキャストして使われますが、Ruby が特別扱いした小さいオブジェクト ( special constants ) は例外的にこの VALUE に直接埋め込むようになっています。定義は ここに記述されています が、例えば以下のようなものが該当します。true, falsenilsizeof(VALUE)*8-1 ビットに収まる符号付き整数これらの小さいオブジェクトは VALUE だけで実現されるため、Ruby VM は新たにメモリを確保する必要がなく、非常に高速に扱うことができます。実際に確認してみると$ pry -robjspace[1] pry(main)\u003e ObjectSpace.memsize_of(nil)=\u003e 0[2] pry(main)\u003e ObjectSpace.memsize_of(true)=\u003e 0[3] pry(main)\u003e ObjectSpace.memsize_of(0)=\u003e 0と、このようにすべてメモリ使用量が 0 となっています。普通のオブジェクト先程 Ruby のオブジェクトは内部では VALUE に相当すると書きましたが、一般的なオブジェクトにおいて VALUE は型ごとの構造体 ( 例えば RString ) をさすポインタです。つまり、例えば Ruby の String を扱う際、CRuby 内部では以下のような RString を指す VALUE ポインタを扱っていることになります。ruby.hstruct RString {    struct RBasic basic;    union {    struct {        long len;        char *ptr;        union {        long capa;        VALUE shared;        } aux;    } heap;    char ary[RSTRING_EMBED_LEN_MAX + 1];    } as;};いわゆる普通のオブジェクトは Ruby VM が確保したヒープ上にメモリを確保して保持されます。Ruby ではメモリを抽象化して扱うためのデータ構造が実装されており、 Heap, Page, Slot といった概念が登場します。これらをざっくり説明すると以下のような形になっています。Heap は Page をいくつももち、Ruby VM がメモリ不足を感じると Page を増やしますPage にはデフォルト値だと 408 個の Slot が入っており、Slot は 40 byte なので 16KB となりますRVALUE 構造体RVALUE は要素を一つだけ持つ構造体で、 Ruby の世界におけるクラス(例えば String)とそれに対応する CRuby 内部の型 ( 例えば RString ) が 列挙されています。gc.ctypedef struct RVALUE {    union {    struct {        VALUE flags;        /* always 0 for freed obj */        struct RVALUE *next;    } free;    struct RBasic  basic;    struct RObject object;    struct RClass  klass;    struct RFloat  flonum;    struct RString string;    struct RArray  array;    /* ~snip~ */    } as;} RVALUE;Ruby ではメモリの管理をする時にこの RVALUE を介して行うようになっています。RVALUE の中はただの共用体なので、実体は RString だったり RArray だったりしますが、すべてサイズは 40 byte です。新たなオブジェクトを生成する必要があれば、 Ruby は空いている Slot ( つまり RVALUE ) を探して使用します。そのため、サイズが 0 ではないオブジェクトのうち、最も小さいサイズは 40 byte となります。$ pry -robjspace[1] pry(main)\u003e ObjectSpace.memsize_of(\"\")=\u003e 40[2] pry(main)\u003e ObjectSpace.memsize_of([])=\u003e 40クラスにより内部実装が違うため詳細は割愛しますが、オブジェクトが大きなデータを持つことになった場合、 Ruby VM はすでに確保した 40 byte とは別に OS から追加のメモリを確保して格納します。$ pry -robjspace[1] pry(main)\u003e ObjectSpace.memsize_of([1])=\u003e 40[2] pry(main)\u003e ObjectSpace.memsize_of([1, 2, 3])=\u003e 40[3] pry(main)\u003e ObjectSpace.memsize_of([1, 2, 3, 4, 5])=\u003e 80[4] pry(main)\u003e ObjectSpace.memsize_of([1, 2, 3, 4, 5, 6, 7])=\u003e 96GC ( Garbage Collection )GC とは直訳して「ゴミ集め」となるように、簡単に言えばゴミとなったオブジェクトを集めて捨て、メモリを有効活用するための仕組みです。これによりエンジニアはオブジェクトが欲しくなったら作るだけ作っておけばあとは Ruby が勝手に掃除してくれます。つまりは malloc や free をエンジニアが意識しなくても良いのです。それにもかかわらずメモリについて記事を書いているわけですが。Ruby の GC では Mark \u0026 Sweep というアルゴリズムを採用しています。このアルゴリズムは簡単に言うと1. Mark フェーズ: 使用中のオブジェクトから参照されているオブジェクトにフラグを付ける2. Sweep フェーズ: どこからも参照のない ( = 使われていない ) オブジェクトを解放するというものです。例えば、大きな String のオブジェクトがあったとします。このとき RString の予め確保されていた 40 byte に収まらない場合、外部からメモリを確保して文字列を格納し、 RString にはそのポインタのみを保持します。この String オブジェクトが不要となった場合、Slot ( RVALUE ) の実体は free となり、外部からメモリを確保して保持しておいた実体の文字列はどこからも参照されなくなります。このようなオブジェクトが GC によって Mark されず Sweep フェーズにて解放されます。素朴な Mark \u0026 Sweep の実装だと GC の処理中にはプログラム本体の処理が行えないなどの問題がありますが、Ruby では近年のアップデートにて解決とまではいかなくとも大幅な改善がされています。気になる方は「Lazy Sweep」「BitmapMarking」「RGenGC」などと調べてみると面白いと思います。省メモリによる高速化戦略メモリにまつわる低速化の代表例として以下のものが挙げられます。GC の頻度増大および負荷増大メモリの確保 ( malloc ) にかかる時間の増大つまり GC を少なく、メモリ確保も極力させないようなプログラムの記述を目指していくことになります。GC TuningRuby には GC の挙動を制御するための環境変数がいくつか定義されています。アプリケーションによって「メモリの使用量」や「オブジェクトの平均寿命」などの傾向が違うため、その違いを鑑みた GC の実行戦略を立てることができます。例えば RUBY_GC_HEAP_INIT_SLOTS という変数がありますがこれは「起動時に確保されるスロット数」で、デフォルト値で 10000 となっています。この値は一般的な Rails アプリケーションにとっては少なすぎるはずです。Rails 起動までに実行された GC の数などを参考にしてチューニングすると良いでしょう。破壊的メソッドの使用これはオブジェクトの生成数を抑え、Slot 外部からのメモリ確保や Page 数増加による malloc の実行回数を減らすことが主目的です。加えて不要となるオブジェクトを減らすこともでき、GC のコストも低減できます。例えば sort -\u003e sort!, chomp -\u003e chomp! のように代替することでオブジェクトの生成を防ぎ、同一の Slot を使用し続けるように促します。いつでも使えるわけではないため頭の隅に入れておき、保守性に影響が無い程度に使っていくと良いと思います。jemallocRuby ではバイナリのビルド時に何も指定しないと glibc による malloc 実装でビルドされます。バージョン 2.2 以降の Ruby には glibc ではなく jemalloc を有効化してビルドするオプションが追加されました。./configure --with-jemallocglibc と jemalloc の違いについて詳細は省きますが、例えばメモリ割り当ての最小サイズに違いがあります。 jemalloc に変更するだけで省メモリ化したという報告もありますので、アプリケーションの特性にうまく噛み合う場合は非常に有効となりそうです。Changed https://t.co/gdEcgB9xMR to use jemalloc 5.0.1 and the memory usage is way more stable. Thanks for the push @mperham pic.twitter.com/PHJTzwWKON— David Jones (@d_jones) 2018年4月27日また、メモリ確保にかかる時間についてもアプリケーションによっては 10% - 12% 改善されるとの報告もあります。それぞれの Allocator の特性と自分のアプリケーションの特性を照らし合わせて判断できれば理想的でしょう ( もしくは canary release をしてみてデータを集めてみても良いかもしれません )。jemalloc による改善が非常に大きいため、 Ruby のデフォルトにすべきではないかという提案もされています。おわりに長くなってしまいましたがざっくり Ruby におけるメモリについて整理してみました。間違いなどありましたらコメントなどで教えていただければ幸いです。ありがとうございました!refRubyソースコード完全解説レアでアレなGCの話Rubyのしくみ -Ruby Under a Microscope- / Pat Shaughnessy (著), 島田 浩二  (翻訳), 角谷 信太郎  (翻訳) / オーム社","link":"https://qiita.com/kamina_zzz/items/0540f663832e07ee1b10","isoDate":"2018-12-25T08:47:12.000Z","dateMiliSeconds":1545727632000,"authorName":"kamina_zzz","authorId":"kamina_zzz"},{"title":"入門 Rancher v2","contentSnippet":"食べログ Advent Calendar も終盤に差し掛かってきましたね。20日目は DevOps チームの @kamina_zzz が Rancher 環境の構築を紹介します。よろしくお願いいたします!はじめに今回は Rancher について、役割の紹介から導入までをお話します。こんな人を対象にしています。コンテナを Kubernetes で運用したいRancher を触ってみたいけど v2.x 系の入門記事を読みながら簡単な実践をしてみたいRancher の名前は聞いたことがあるけど実際のところ何者なのかわからない、知りたいリソースが オンプレ/AWS/GCP など、多岐に渡るシステムを運用したいメインはクラウドだけど、 GPU環境だけはオンプレ みたいなチーム、わりとありそうですよねKubernetes を勉強したいがクラウドサービスを使わずに環境を用意したいRancher を使いたいがメンバーへの布教用に v2.x の簡単な紹介記事がほしいそもそも Rancher って?Rancher は一言で言うと「複数の Kubernetes Cluster を管理・運用するためのツール」です。ちなみに Rancher OS と Rancher は別物です。また Rancher 1.6 と 2.x も 別物と思ったほうが良い です。Rancher が何者なのかを理解するのに一番手っ取り早いのは「何をしてくれるのかについて知る」だと思いますので早速 Rancher の構成要素を紹介します。主な構成要素Cluster Controller/AgentRancher がメイン機能である Kubernetes (以下 k8s) クラスタの管理がこのコンポーネントによって提供されています。Cluster Agent は各 k8s クラスタに対して存在しており、Rancher は Cluster Controller を通して Agent とやりとりすることで k8s 内部のことを知ることができます。Auth Proxy名前の通りユーザー認証周りのことをやってくれるコンポーネントです。ピュアな k8s では「操作対象」「操作者」「操作内容」に対しては無関心であるため、様々なユーザーによって運用されるシステムではシステム構築者が考えてやる必要があります。この認証機能のおかげで「このユーザーはこのクラスタに対してこの操作はできる/できない」といったことの管理がしやすくなります。kubectl や k8s の WebAPI などのピュアな k8s が提供している機能もこの認証機能を通して実行することで適切に権限の管理ができます。WebAPIk8s はそれ自身にも WebAPI の機能がありますが、 Rancher 自体にも WebAPI が備わっています。この WebAPI を通すことで Rancher が提供するクラスタ管理の機能などを GUI を使わずとも操作することができ、自動化などの応用に夢が広がります。やってみるRancher が何をしてくれるものなのか、ぼんやり見えてきたかと思いますがやっぱり自分で手を動かすに越したことはありません。今回は Mac で 公式の vagrant を使った構築 をしてみましょう。準備公式のリポジトリがとても良くできているのであっという間にできます。git clone https://github.com/rancher/quickstartcd quickstart/vagrantvagrant upこれだけ。使ってみるデフォルトでは https://172.22.101.101 にサーバーが立ち上がります。ここへアクセスするとログイン画面が出てくると思います。デフォルトの ID/Pass は admin/admin なので、入力してクラスタを見てみます。quickstart という名前でクラスタができていますね。中を見てみるとノードがひとつだけあり、こいつが k8s の master と worker を兼ねています。実際に Workload を追加してみましょう。quickstart クラスタの Default を開いてDeploy を押して nginx の pod を追加してみましょう。name  は何でも良いですが今回は nginx としましたイメージは nginx:latest を使いますこのまま save を押すと nginx の pod がデプロイされます。次に疎通するための Ingress LB を作りましょう。Load Balancing タブを選び、以下の内容で nginx をバックエンドとした LB をつくります。name は例によって何でも良いですが lb としましたTarget のプルダウンから nginx を選択Port に 80 を指定これで save すると nginx へ疎通するための LB ができ、しばらくするとhttp://lb.default.xxx.xxx.xxx.xxx.xip.io/ のようなアドレスが生成されます。ここにアクセスするとローカルIPに名前解決され、nginx へ接続できます。おわりに本来であれば他にもrancher コマンドのセットアップカタログからワークロードの追加High Availability 構成などの話題も触れておくべきかと思いましたが、思った以上に長くなってしまいましたのでまた別の機会にでも書こうと思います。特に、HA 構成については面白い (rke で k8s クラスタ作って helm で rancher server の chart をインストールして構築…k8s がネストする!) ので興味がある方は 公式のドキュメント を参考に作ってみるのも良いかと思います。明日は @uribou による 「MS Teams を使って例外が起きたら通知するようにしてみた」です。お楽しみに〜refhttps://rancher.com/https://rancher.com/docs/rancher/v2.x/en/","link":"https://qiita.com/kamina_zzz/items/5f231391733b28250088","isoDate":"2018-12-17T10:38:55.000Z","dateMiliSeconds":1545043135000,"authorName":"kamina_zzz","authorId":"kamina_zzz"},{"title":"最強GPUを自由に触れる食べログの開発環境を紹介するよ","contentSnippet":"はじめまして、エンジニアとして ML やら DevOps をやっている @kamina_zzz です。Advent Calendar 2日目の今日は食べログの最強な機械学習開発環境について紹介していきます。よろしくお願いいたします!経緯機械学習における学習フェーズでは行列計算の占める割合が多い傾向にあります。行列計算に強い GPU を使った機械学習が注目されて久しく、特に画像認識などにおいては「GPU を使うのが主流だよね!」といった雰囲気さえあります(要出典)。一方、食べログはありがたいことに多くのユーザーさんに使って頂いており、2018/10/01 時点では国内総合37位、Food and Drink カテゴリにおいては国内1位のトラフィックがあります。このトラフィックをベースとしためちゃくちゃにデカいログなどのデータを日々データレイクに投げ込んでいまして、学習にはこのデータを使っていくわけです。まともにやり合おうとすると計算量的にまずい予感がします。というか、工夫してうまいこと圧縮したとしてもかかる時間は短いに越したことはありません。さらにさらに、どうせなら 最強 で 使い倒せる環境 がほしいじゃないですか。ほしいですよね。構築最強で使い倒せる環境って人によってはいろんな回答があるかと思いますが、食べログでは以下のようになりました。オンプレミスクラウドの利用が非常に盛んな今日このごろですが、クラウドで GPU インスタンスを見てみるとめちゃめちゃ高いです。これはまずい。お上も「こんなに高いんだとちょっと…プロトタイプくらいは Mac で作って?」となりかねないです。あぶない。それではエンジニアの作業にも影響が出てしまいそうですし、「許可をとって…」とか「予算が…」とかしているうちにスピード感は落ちてしまいます。食べログではオンプレミスのマシンを受け入れるための環境が たまたま ありましたので、オンプレミスでの構築を採用しています。NVIDIA Tesla V100そもそも機械学習ライブラリの多くは NVIDIA のライブラリを使用することが多く(というか AMD のものを僕が知らない)、NVIDIA 製の商用 GPU で最強なのを選定したらコレになりました。せっかくなので2枚入れておきます。Docker の利用Web アプリの世界だけでなく ML の世界でももはやコンテナの利用は一般的となってきています。依存ライブラリの解決や並列化など、様々なメリットがあるため食べログの ML 環境もコンテナベースの運用となっています。複数ホスト上で多数の pod によるスケーラブルな学習を手軽にできるよう、Kubernetes 環境を構築することも決まっており、現在鋭意構築中です。結果いざ実際に動かしてみるとその凄さがわかります。うちの子がどんなにすごいか少しだけ自慢させていただくために GPU を使って MNIST やってみます。1. GPU マシン上でコンテナ起動$ nvidia-smi -LGPU 0: Tesla V100-PCIE-16GB (UUID: GPU-xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx)GPU 1: Tesla V100-PCIE-16GB (UUID: GPU-xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx)$ sudo nvidia-docker run -it tensorflow/tensorflow:latest-gpu-py3 bash2. MNIST 実行して時間測ってみます$ time python3 mnist_cnn.pyUsing TensorFlow backend.x_train shape: (60000, 28, 28, 1)60000 train samples10000 test samplesTrain on 60000 samples, validate on 10000 samplesEpoch 1/12# ~ 中略 ~2018-mm-dd 00:00:00.000000: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1115] Created TensorFlow device (/job:localhost/replica:0/task:0/device:GPU:0 with 14873 MB memory) -\u003e physical GPU (device: 0, name: Tesla V100-PCIE-16GB, pci bus id: 0000:08:00.0, compute capability: 7.0)2018-mm-dd 00:00:00.000000: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1115] Created TensorFlow device (/job:localhost/replica:0/task:0/device:GPU:1 with 14873 MB memory) -\u003e physical GPU (device: 1, name: Tesla V100-PCIE-16GB, pci bus id: 0000:84:00.0, compute capability: 7.0)60000/60000 [==============================] - 8s 139us/step - loss: 0.2796 - acc: 0.9140 - val_loss: 0.0588 - val_acc: 0.9822Epoch 2/1260000/60000 [==============================] - 3s 47us/step - loss: 0.0906 - acc: 0.9732 - val_loss: 0.0428 - val_acc: 0.9853Epoch 3/1260000/60000 [==============================] - 3s 47us/step - loss: 0.0690 - acc: 0.9796 - val_loss: 0.0357 - val_acc: 0.9886Epoch 4/1260000/60000 [==============================] - 3s 47us/step - loss: 0.0559 - acc: 0.9834 - val_loss: 0.0325 - val_acc: 0.9885Epoch 5/1260000/60000 [==============================] - 3s 47us/step - loss: 0.0470 - acc: 0.9856 - val_loss: 0.0287 - val_acc: 0.9908Epoch 6/1260000/60000 [==============================] - 3s 47us/step - loss: 0.0418 - acc: 0.9874 - val_loss: 0.0287 - val_acc: 0.9908Epoch 7/1260000/60000 [==============================] - 3s 48us/step - loss: 0.0372 - acc: 0.9887 - val_loss: 0.0281 - val_acc: 0.9909Epoch 8/1260000/60000 [==============================] - 3s 47us/step - loss: 0.0342 - acc: 0.9895 - val_loss: 0.0287 - val_acc: 0.9904Epoch 9/1260000/60000 [==============================] - 3s 46us/step - loss: 0.0322 - acc: 0.9903 - val_loss: 0.0277 - val_acc: 0.9916Epoch 10/1260000/60000 [==============================] - 3s 46us/step - loss: 0.0296 - acc: 0.9909 - val_loss: 0.0248 - val_acc: 0.9926Epoch 11/1260000/60000 [==============================] - 3s 45us/step - loss: 0.0280 - acc: 0.9914 - val_loss: 0.0284 - val_acc: 0.9909Epoch 12/1260000/60000 [==============================] - 3s 45us/step - loss: 0.0266 - acc: 0.9919 - val_loss: 0.0368 - val_acc: 0.9884Test loss: 0.03678337639837555Test accuracy: 0.9884real    0m43.708suser    0m50.604ssys     0m29.223sいやこれ、めっちゃ早くないですか?ちなみに手元の Mac だと 24分 とかかかりました。以上、食べログの開発環境について紹介させていただきました。明日は @weakboson による「ハァイ、ジョージィ！reverse proxy立ててくれないのかい？」です。お楽しみに〜!","link":"https://qiita.com/kamina_zzz/items/58d831c7b238fb4b409c","isoDate":"2018-11-30T03:05:51.000Z","dateMiliSeconds":1543547151000,"authorName":"kamina_zzz","authorId":"kamina_zzz"},{"title":"Go の Revel フレームワークでタイムゾーンを設定する","contentSnippet":"動機Revel を new して開発を進めていくと、ログに出る時間が local タイムゾーンとズレていることがわかった。sample_request.logINFO  13:20:49    app server-engine.go:213: Request Stats                            namespace=App\\\\ duration_seconds=0.0003713 section=requestlog  ip=127.0.0.1 method=GET action=App.Index path=/ start=2018/11/15 13:20:49 status=200脳内変換しても良いのだが、そもそもすべての時間を JST にしたほうが都合が良いこともあったので対応することにした。アプリケーション全体のタイムゾーンを変更するRevel 自体の config には timezone に関するものは無いようなので、go 標準ライブラリの time を使って実現する。Revel では app/init.go がアプリケーション全体に対する initializer としての機能を提供しているので、この場でタイムゾーンを指定してやれば良さそう。app/init.go  import(      \"github.com/revel/revel\"+     \"time\"  )  func init() {      // JST だと UTC との差は +9時間      // \"Asia/Tokyo\" はラベルでしかないので、開発者がわかりやすければ何でも良い+     time.Local = time.FixedZone(\"Asia/Tokyo\", int((9 * time.Hour).Seconds()))  // ~~ snip ~~  }ドキュメントにもあるように、場合によってはすでに定義済みの timezone location があるのであればそれを使ってもよい。// If the system has a timezone database present, it's possible to load a location  // from that, e.g.:  //    newYork, err := time.LoadLocation(\"America/New_York\")そっちがあるならそちらを使う、という実装にするのであれば例えば以下のようになる。app/init.go  import(      \"github.com/revel/revel\"+     \"time\"  )+ const location = \"Asia/Tokyo\"  func init() {+     loc, err := time.LoadLocation(location)+     if err != nil {+         loc = time.FixedZone(location, int((9 * time.Hour).Seconds()))+     }+     time.Local = loc      // ~~ snip ~~  }おしまい。ref","link":"https://qiita.com/kamina_zzz/items/7ef09ea27da38c6db9db","isoDate":"2018-11-15T05:02:35.000Z","dateMiliSeconds":1542258155000,"authorName":"kamina_zzz","authorId":"kamina_zzz"},{"title":"RをMacOS Xにbrewでインストールするとちょっとハマる、ということ","contentSnippet":"方針ソースから入れるのはめんどくさいので homebrew で入れてしまいましょう。筆者のハマり方Rはgfortran に依存していて、現在はgfortranはgccの一部として提供されている。そのため普通にbrew isntall rすると依存関係のあるgccも同時に入れられるのだが、そのパスがうまいことRに伝わらないため、動かない。症状と対処$ brew install r$ rdyld: Library not loaded: /usr/local/opt/gcc/lib/gcc/6/libgfortran.3.dylib  Referenced from: /usr/local/Cellar/r/3.3.0_1/R.framework/Versions/3.3/Resources/lib/libR.dylib  Reason: image not foundTrace/BPT trap: 5要は、Rさんとしてはgccのlibgfortran.3.dylibを使いたいんだけども、そのパス指定が間違っている。今回のタイミングであればgcc6のバージョンが入るのだけど、本体は/usr/local/Cellar/gcc6/6-{日付}のようなパスに存在し、そこへのシンボリックリンクが/usr/local/opt/gcc6という名前で貼ってある。でもRさんはなぜかusr/local/opt/gccという名前を呼んでいるので、今回はusr/local/opt/gccという名前でusr/local/opt/gcc6へのリンクを作成することで対処した。1$ ln -s /usr/local/opt/gcc6 /usr/local/opt/gcc$ rR version 3.3.0 (2016-05-03) -- \"Supposedly Educational\"Copyright (C) 2016 The R Foundation for Statistical ComputingPlatform: x86_64-apple-darwin14.5.0 (64-bit)...ようやく無事に動いてくれました。懸念点として、gccのバージョンが上がるたびにこいつを書き換えなくてはならないかもしれないということ。gcc6自体を削除しなければ問題はないが、さて…という感じ。gccのバージョンが上がるのとRのインストーラーのバグが解消されるのとどっちが早いか… ↩","link":"https://qiita.com/kamina_zzz/items/f4a441d833e7b03930a8","isoDate":"2016-06-12T06:49:25.000Z","dateMiliSeconds":1465714165000,"authorName":"kamina_zzz","authorId":"kamina_zzz"},{"title":"AWSのGPU有りインスタンスにChainer 1.5を最も簡単にインストールする","contentSnippet":"はじめに執筆時点での一番簡単なインストール方法を記したつもりです。間違い等ありましたらコメントしていただけるとありがたいです。以下のような方を想定して書いています。EC2インスタンスは建てたことがある(そこまで詳しくある必要は無い)Chainerを使ってみた、あるいは初めて使ってみるがどうせならGPUを使いたい簡単にやりたい 1手順の概要NVIDIAが公開しているCUDA及びGPUドライバインストール済みのAMIを使用してインスタンスを作成Chainerが必要とする依存ライブラリ郡をインストールChainerをインストール下準備GPUをフル活用するためにはNVIDIAのライブラリを使う必要があります。NVIDIAのライブラリはフリーですが、使うには事前に登録する必要があるので先にしましょう(Registeringに多少時間がかかります)。公式cuDNNページ詳しい手順は明記しませんが、 Register の ボタンから登録を済ませ、確認用メールにて本登録処理をしておいてください。手順1. EC2インスタンスの作成最も一般的と思われるインスタンスの作成はAmazon Linuxを選択して作成する方法だと思いますが、今回はAmazonマーケットプレイスに公開されているNVIDIAのAMIを使います。この画面左のタブからAWS Marketplaceを選択して検索窓で「NVIDIA」と入力して以下のイメージを探します。次へ進むと 2xlarge と 8xlarge が選択できるようになっていますが、 2xlarge しか使ったことがないのでどれほどの性能差があるかはわかりません。このままあとはいつもどおり作成しましょう。手順2. Chainer依存ライブラリ群のインストールcuDNNNVIDIA公式AMIを使うとCUDAの状態は install directory: /opt/nvidia/cuda  version: 6.5なので(執筆時)、CUDAに依存するパッケージであるcuDNNもこれに対応してインストールします。下準備で登録したメールアドレスに Congratulations, you are now a member of the Accelerated Computing Developer Program のような内容が届いていれば本登録済みなので次に進みましょう。来てない場合は先に進まずにコーヒーでも淹れるのが吉です(Chainerは 本体より先に 依存ライブラリを入れておくことが推奨されている)。公式からDownloadをクリック。CUDA6.5に対応するcuDNNは v2 なので、下の Archived cuDNN Releases クリックして cuDNN v2 Library for Linux をダウンロードし、インスタンスのサーバーにアップロードして展開しておきましょう。2あとは展開したディレクトリへ移動し、$ sudo cp lib* /opt/nvidia/cuda/lib64$ sudo cp cudnn.h /opt/nvidia/cuda/include/これでおっけーです。3hdf5Chainer1.5から依存パッケージに h5py 2.5.0 が仲間入りしました。これはPythonのライブラリですが hdf5 を前提にされているため、こいつだけ手動でいれてあげましょう。$ sudo yum-config-manager --enable epel$ sudo yum install -y hdf5-devel依存パッケージはこれにて終了です。Chainerのインストール1行です。4$ sudo CUDA_PATH=/opt/nvidia/cuda pip install chainer一応確認しておきましょう。$ python\u003e\u003e\u003e import chainerエラーが出なければ問題ないでしょう。お疲れ様でした。おわりに長々と書きましたがだいたいは公式に書いてあるとおりやっただけです。ただ、hdf5の依存でハマったりcuDNNのインストールでハマったり(テキトーに最新版入れとけ→あぼーん)したので、参考になれば幸いです。以下、参考にさせていただきました。Amazon EC2のGPUインスタンスにChainer v1.5を3行で入れるAWS EC2のg2.2xlargeをスポットインスタンスで立てて、chainerを動かしてみるGPUを使わない場合はもっと簡素にできます。 ↩ちなみに最新版を使いたい場合など、CUDAを自前で入れる等している場合は対応するcuDNNのバージョンも違います。 ↩CUDA7.0以上を使いたくてcuDNNもv3以上を用意する場合は、cuDNN解凍後のディレクトリ構造が違うので注意。また、Chainer1.5はcuDNN v3までの対応なので、v4とかはサポート外(執筆時)なのでやめておくことをおすすめします。 ↩sudoを使うと環境変数を維持できないので公式で書かれてる通りインストーラーに伝える ↩","link":"https://qiita.com/kamina_zzz/items/732275bd9e107ce1a964","isoDate":"2016-01-13T18:16:28.000Z","dateMiliSeconds":1452708988000,"authorName":"kamina_zzz","authorId":"kamina_zzz"},{"title":"ログインユーザーの環境変数のままsudoする","contentSnippet":"動機sudoで動かしたいコマンドがあったが、そのコマンド内で環境変数を参照する。しかし、rootユーザーでは参照する環境変数がセットされていない(ログインユーザーの環境変数にのみ存在する)解決策大きく分けてふたつあるどうにかしてrootユーザーの環境変数にもログインユーザーと同じものをセットするログインユーザーの環境変数を一時的に使ってsudoする今回は後者の方法を取ったやり方は簡単でlogin-user$ sudo -E commandそう、 -E をつけるだけです。","link":"https://qiita.com/kamina_zzz/items/29bda444cb800ded1347","isoDate":"2015-05-21T09:41:07.000Z","dateMiliSeconds":1432201267000,"authorName":"kamina_zzz","authorId":"kamina_zzz"},{"title":"Windows7でF8キーを使わないセーフモードの起動方法","contentSnippet":"はじめにWindows7であるファイルを弄りたいと思った。念のためセーフモードを起動させたいと思いたち、検索するとごまんと出てくるのはF8キーをWindows立ち上げ前に連打する、というものである。そんな中、キーボードの種類によっては(あるいはBIOSの種類によっては)Windows起動前にキー入力が受け付けられないことがある。筆者がまさにそうで、解決方法を探ったので共有(備忘録)しようと思った次第である。セーフモードで起動するようにするWindowsキー→検索窓(もしくは+Rキー同時押し)からmsconfig.exeと入力するとこんなかんじで出てくるので、セーフブートにチェックを入れてOK→再起動するとあら不思議セーフモードで起動できます。","link":"https://qiita.com/kamina_zzz/items/89ed78ae5e396c34964c","isoDate":"2014-12-18T17:56:22.000Z","dateMiliSeconds":1418925382000,"authorName":"kamina_zzz","authorId":"kamina_zzz"},{"title":"dotfilesの初期化用スクリプト","contentSnippet":"はじめにdotfiles、便利ですよね。でも環境が変わるごとにシンボリックリンク貼ったり、大変ですよね。しかも環境が変わるってのは普通はあんまりないですし、何すればいいんだっけ？ってなりますよね。よね？？私はなります。対象者すでにdotfilesを運用してるひとNeoBundleでVimプラグインを管理しているひと毎回いちいち設定するのめんどくせえってひと一括処理しよう一度、バッチ処理するシェルプログラム書いておけば安心ですね。はい、書きました。init_dotfiles.sh#!/bin/sh# current dircd $(dirname $0)# download neobundle filesif [ -e ~/dotfiles/vimfiles/bundle/neobundle.vim ]; then    echo \"neobundle found\"    is_existed=trueelse    echo \"install neobundle\"    mkdir -p ~/dotfiles/vimfiles/bundle/    git clone https://github.com/Shougo/neobundle.vim ~/dotfiles/vimfiles/bundle/neobundle.vim    is_existed=falsefi# make symlinkfor dotfiles in .?*; do    case $dotfiles in         ..)            continue;;        .git)            continue;;        *)            ln -Fis \"$PWD/$dotfiles\" $HOME;;    esacdoneif [ -e ~/.vim ]; then    echo \".vim found. rename .vim dir\"else    ln -vFis ~/dotfiles/vimfiles ~/.vim;fi# install \u0026 update NeoBundle pluginsif [ \"${is_existed}\" == true ]; then    echo \"running NeoBundleUpdate...\\n\"    vim -u ~/.vimrc -i NONE -c \"try | NeoBundleUpdate! | finally | q! | endtry\" -e -s -V1else    echo \"running NeoBundleInstall...\\n\"    vim -u ~/.vimrc -i NONE -c \"try | NeoBundleInstall! | finally | q! | endtry\" -e -s -V1fiecho \"\\ncompleted!\"動作環境CentOS 6.5, OS X 10.9.5のみ確認済みです。想定する構成はdotfiles  │  .vimrc  │  .bashrc  ~  │  init_dotfiles.sh  └─ vimfiles      └─ bundleのような感じです。運用非常に簡単です。$ cd ~$ git clone https://github.com/your_account/dotfiles.git$ sh init_dotfiles.sh以上です。ね、簡単でしょ？ちなみにすでに環境がある状態で$ sh init_dotfiles.shとするとプラグインのアップデートがかかります(NeoBundleUpdate)おわりに注意点がいくつかあります。Gitで2段階認証している場合はMacからだとPushできない可能性があります。vimfiles/bundle/以下がgitignoreされていない場合、何か良くないことが起こりそうな気もしますルートディレクトリの.vim/や.bashrcは事前に移動か削除しておく必要があると思います。以上です。Enjoy! XD","link":"https://qiita.com/kamina_zzz/items/1544056b165b6ca35d5c","isoDate":"2014-10-16T10:05:33.000Z","dateMiliSeconds":1413453933000,"authorName":"kamina_zzz","authorId":"kamina_zzz"},{"title":"Vim初心者がvimrcを育てていく","contentSnippet":"はじめにVim初心者の自分もやっぱりVimをカスタマイズしたいと考えた。想定する対象者はとりあえずvimとかよくまだわかんないけど、最近の主流っぽいvimmerの環境を整えたい方[web開発に関わる、vimを複数仮想マシンで使いたい方](不備があればコメント下さい。)前提環境のOSはLinux系(CentOS 6.5系, Ubuntu14系, などなど)ここではshellはbashを想定(違ってもできるのでそのへんは適宜読みかえて、どうぞ)Gitはある程度すでに使えるvim7.3以上を導入済みCentOS 6.3にVim 7.3をインストールするここに書いてることvimrcをカスタマイズNeoBundleでプラグイン管理設定ファイル郡(dotfiles)をGitで管理vimrcを書いていく特に難しいことはない。ユーザーディレクトリに.vimrcを設置して書いていくだけ。基本的にはこのファイルでvimをカスタマイズしていくことができる。例えば、「TabはキモチワルイからTabキーで半角スペース4ずつに展開したい」なら.vimrc\"Tabをスペース4つに展開＆Tabの設定set tabstop=4set autoindentset expandtabset shiftwidth=4みたいに書いておけばそうなってくれる。ちなみに即時適用したいときはvim起動中に:source .vimrcで適用される。他にもいろいろ設定できるので自分のほしい設定を探してみると育てている感が楽しい。参考：vimの全オプションNeoBundleのプラグイン管理世界にはたくさんのVim用プラグインがある。それらを統括的に管理してくれるプラグインがあり、そのひとつがNeoBundleである。管理と言っても、プラグインによっては個別にコンパイルが必要だったりするので、自分の入れたいプラグインは自分で調べるべき。まずNeoBundle本体を落としてくる。$ mkdir -p ~/.vim/bundle$ git clone https://github.com/Shougo/neobundle.vim  ~/.vim/bundle/neobundle.vim本体を落としてきたら.vimrcの方にもそれ用に記入.vimrcset nocompatibleif has('vim_starting')  set runtimepath+=~/.vim/bundle/neobundle.vimendifcall neobundle#begin(expand('~/.vim/bundle/'))NeoBundleFetch 'Shougo/neobundle.vim'\" ここに入れたいプラグインを記入call neobundle#end()filetype plugin indent onこれでVim起動中に:NeoBundleInstallで導入は完了。たとえば、基本的なシンタックスのチェックプラグインを入れたいなら.vimrcNeoBundle 'scrooloose/syntastic'のように記入して、:NeoBundleInstallで導入できる。アップデートしたいなら:NeoBundleUpdateで。参考：NeoBundledotfilesをGit管理vimを使いはじめると、あらゆる環境で使えるというvimの強みをいかして自分のカスタマイズをどこでも統一して適用したいと考えはじめるだろう。(※あらゆる環境と言いつつ今回の設定ではwin環境では使えないと思われます)ここではdotfilesという名前が示す通り、vim関連のファイルにかぎらず.bashrcや.zshrcなども管理下に含めることでその辺の環境も統一したいという動機が背景にある(このように管理するとき一般的にdotfilesという名称が使われているようだ)。事前にGithubで新規repositoryをREADME.mdファイル無しで作成しておく。ホームディレクトリにdotfilesディレクトリを作り、各種ファイルを移動する(今回はvim関連のファイル郡のみ)。ホームディレクトリにはsymlinkを貼っておく。$ mkdir ~/dotfiles$ mv ~/.vimrc ~/dotfiles/.vimrc$ mv ~/.vim ~/dotfiles/vimfiles$ ln -Fis ~/dotfiles/.vimrc ~/.vimrc$ ln -Fis ~/dotfiles/vimfiles ~/.vim$ cd ~/dotfiles$ git initここまでしたら、.gitignoreファイルを作成して/vimfiles/bundle/*を追加しておく。あとはaddしてcommitしてpushしてください。他環境で引っ張ってくるときは1. 自分のdotfilesリポジトリをclone2. neobundleをvimfiles/bundle配下にclone3. ホームディレクトリにsymlink作成4. vimを開いて:NeoBundleInstall5. enjoy以下とても参考にさせていただきました。いつでもどこでも同じ.vimrcを使うNeoBundleによるVimプラグイン管理とおすすめプラグイン世界のvimmerの先輩方","link":"https://qiita.com/kamina_zzz/items/4d2f2f12df8512fac889","isoDate":"2014-08-26T07:50:19.000Z","dateMiliSeconds":1409039419000,"authorName":"kamina_zzz","authorId":"kamina_zzz"}]},"__N_SSG":true},"page":"/members/[id]","query":{"id":"kamina_zzz"},"buildId":"gGzRcn4lUXjSZ-YCcOAi3","nextExport":false,"isFallback":false,"gsp":true,"head":[["meta",{"name":"viewport","content":"width=device-width"}],["meta",{"charSet":"utf-8"}],["link",{"rel":"icon shortcut","type":"image/png","href":"https://blog.ubie.tech/logo.png"}],["link",{"rel":"stylesheet","href":"https://fonts.googleapis.com/css2?family=Inter:wght@400;700\u0026display=swap"}],["title",{"children":"kamina_zzz | Ubie Engineers' Blogs"}],["meta",{"property":"og:title","content":"kamina_zzz"}],["meta",{"property":"og:url","content":"https://blog.ubie.tech/members/kamina_zzz"}],["meta",{"name":"twitter:card","content":"summary_large_image"}],["meta",{"property":"og:site","content":"Ubie Engineers' Blogs"}],["meta",{"property":"og:image","content":"https://blog.ubie.tech/og.png"}],["link",{"rel":"canonical","href":"https://blog.ubie.tech/members/kamina_zzz"}]]}</script><script nomodule="" src="/_next/static/chunks/polyfills-fa276ba060a4a8ac7eef.js"></script><script src="/_next/static/chunks/main-8a83f0fd99327c4684a8.js" async=""></script><script src="/_next/static/chunks/webpack-e067438c4cf4ef2ef178.js" async=""></script><script src="/_next/static/chunks/framework.1daf1ec1ecf144ee9147.js" async=""></script><script src="/_next/static/chunks/commons.8d61253ae98ee51657b8.js" async=""></script><script src="/_next/static/chunks/pages/_app-e552cec615d644762a9b.js" async=""></script><script src="/_next/static/chunks/81b50c7ab23905e464b4340eb234bd6ea389d26b.08e7af43e0a5a53b335f.js" async=""></script><script src="/_next/static/chunks/pages/members/%5Bid%5D-0a2d3cf0d329b39cefc0.js" async=""></script><script src="/_next/static/gGzRcn4lUXjSZ-YCcOAi3/_buildManifest.js" async=""></script><script src="/_next/static/gGzRcn4lUXjSZ-YCcOAi3/_ssgManifest.js" async=""></script></body></html>