<!DOCTYPE html><html><head><meta name="viewport" content="width=device-width"/><meta charSet="utf-8"/><link rel="icon shortcut" type="image/png" href="https://blog.ubie.tech/logo.png"/><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700&amp;display=swap"/><title>maguhiro | Ubie Engineers&#x27; Blogs</title><meta property="og:title" content="maguhiro"/><meta property="og:url" content="https://blog.ubie.tech/members/maguhiro"/><meta name="twitter:card" content="summary_large_image"/><meta property="og:site" content="Ubie Engineers&#x27; Blogs"/><meta property="og:image" content="https://blog.ubie.tech/og.png"/><link rel="canonical" href="https://blog.ubie.tech/members/maguhiro"/><link rel="preload" href="/_next/static/css/5b1e5c056c67d836f701.css" as="style"/><link rel="stylesheet" href="/_next/static/css/5b1e5c056c67d836f701.css" data-n-g=""/><noscript data-n-css="true"></noscript><link rel="preload" href="/_next/static/chunks/main-8a83f0fd99327c4684a8.js" as="script"/><link rel="preload" href="/_next/static/chunks/webpack-e067438c4cf4ef2ef178.js" as="script"/><link rel="preload" href="/_next/static/chunks/framework.1daf1ec1ecf144ee9147.js" as="script"/><link rel="preload" href="/_next/static/chunks/commons.8d61253ae98ee51657b8.js" as="script"/><link rel="preload" href="/_next/static/chunks/pages/_app-49079e3278dd6cef7229.js" as="script"/><link rel="preload" href="/_next/static/chunks/81b50c7ab23905e464b4340eb234bd6ea389d26b.f07a62e71140add17478.js" as="script"/><link rel="preload" href="/_next/static/chunks/pages/members/%5Bid%5D-f279413a3daf3c18264d.js" as="script"/></head><body><div id="__next"><header class="site-header"><div class="content-wrapper"><div class="site-header__inner"><a class="site-header__logo-link" href="/"><img src="/logo.png" alt="Ubie Engineers&#x27; Blogs" class="site-header__logo-img"/><span class="site-header__logo-text">Ubie<br/>Engineers&#x27; Blogs</span></a><div class="site-header__links"><a href="https://ubie.life/" class="site-header__link" target="_blank">Company</a><a href="https://recruit.ubie.life/jd_dev" class="site-header__link" target="_blank">Recruit</a></div></div></div></header><section class="member"><div class="content-wrapper"><header class="member-header"><div class="member-header__avatar"><img src="/avatars/megu.jpg" alt="maguhiro" width="100" height="100" class="member-header__avatar-img"/></div><h1 class="member-header__nickname">maguhiro</h1><p class="member-header__real-name">目黒博隆</p><p class="member-header__bio">4児の父親エンジニア。フロント・バックエンド担当してます。</p><div class="member-header__links"><a href="https://twitter.com/maguhiro" class="member-header__link"><img src="/icons/twitter.svg" alt="Twitterのユーザー@maguhiro" width="22" height="22"/></a><a href="https://github.com/maguhiro" class="member-header__link"><img src="/icons/github.svg" alt="GitHubのユーザー@maguhiro" width="22" height="22"/></a><a href="https://note.com/maguhiro" class="member-header__link"><img src="/icons/link.svg" alt="ウェブサイトのリンク" width="22" height="22"/></a></div></header><div class="member-posts-container"><div class="post-list"><article class="post-link"><a class="post-link__author" href="/members/maguhiro/"><img src="/avatars/megu.jpg" class="post-link__author-img" width="35" height="35"/><div class="post-link__author-name"><div class="post-link__author-name">maguhiro</div><time dateTime="2021-06-02T23:28:43.000Z" class="post-link__date">4 months ago</time></div></a><a href="https://note.com/maguhiro/n/nb35bf6c692fe" class="post-link__main-link"><h2 class="post-link__title">4児の父親エンジニアの働き方とそれを支える組織文化・制度</h2><div class="post-link__site"><img src="https://www.google.com/s2/favicons?domain=note.com" width="14" height="14" class="post-link__site-favicon"/>note.com</div></a></article><article class="post-link"><a class="post-link__author" href="/members/maguhiro/"><img src="/avatars/megu.jpg" class="post-link__author-img" width="35" height="35"/><div class="post-link__author-name"><div class="post-link__author-name">maguhiro</div><time dateTime="2021-01-19T09:05:19.000Z" class="post-link__date">8 months ago</time></div></a><a href="https://note.com/maguhiro/n/nfff34cf4156a" class="post-link__main-link"><h2 class="post-link__title">Ubie株式会社に入社しました</h2><div class="post-link__site"><img src="https://www.google.com/s2/favicons?domain=note.com" width="14" height="14" class="post-link__site-favicon"/>note.com</div></a></article><article class="post-link"><a class="post-link__author" href="/members/maguhiro/"><img src="/avatars/megu.jpg" class="post-link__author-img" width="35" height="35"/><div class="post-link__author-name"><div class="post-link__author-name">maguhiro</div><time dateTime="2019-12-16T04:14:14.000Z" class="post-link__date">2 years ago</time></div></a><a href="https://qiita.com/maguhiro/items/30b0d99a8f8e35b8e2f7" class="post-link__main-link"><h2 class="post-link__title">RxSwiftのbind関数をCombineで実装してみた</h2><div class="post-link__site"><img src="https://www.google.com/s2/favicons?domain=qiita.com" width="14" height="14" class="post-link__site-favicon"/>qiita.com</div></a></article><article class="post-link"><a class="post-link__author" href="/members/maguhiro/"><img src="/avatars/megu.jpg" class="post-link__author-img" width="35" height="35"/><div class="post-link__author-name"><div class="post-link__author-name">maguhiro</div><time dateTime="2019-09-10T16:21:18.000Z" class="post-link__date">2 years ago</time></div></a><a href="https://qiita.com/maguhiro/items/065de506969fcd68a8de" class="post-link__main-link"><h2 class="post-link__title">値オブジェクトへのCodable対応 &lt;補足編&gt; #iosdc</h2><div class="post-link__site"><img src="https://www.google.com/s2/favicons?domain=qiita.com" width="14" height="14" class="post-link__site-favicon"/>qiita.com</div></a></article><article class="post-link"><a class="post-link__author" href="/members/maguhiro/"><img src="/avatars/megu.jpg" class="post-link__author-img" width="35" height="35"/><div class="post-link__author-name"><div class="post-link__author-name">maguhiro</div><time dateTime="2018-12-11T04:34:29.000Z" class="post-link__date">3 years ago</time></div></a><a href="https://qiita.com/maguhiro/items/b1a941a13d14abf8424f" class="post-link__main-link"><h2 class="post-link__title">iOS Test Night 第9回目 参加レポート #ios_test_night</h2><div class="post-link__site"><img src="https://www.google.com/s2/favicons?domain=qiita.com" width="14" height="14" class="post-link__site-favicon"/>qiita.com</div></a></article><article class="post-link"><a class="post-link__author" href="/members/maguhiro/"><img src="/avatars/megu.jpg" class="post-link__author-img" width="35" height="35"/><div class="post-link__author-name"><div class="post-link__author-name">maguhiro</div><time dateTime="2018-12-10T09:30:56.000Z" class="post-link__date">3 years ago</time></div></a><a href="https://qiita.com/maguhiro/items/fdeab3efdcbc8a4ed545" class="post-link__main-link"><h2 class="post-link__title">MS Teamsへのメッセージ送信用Bitrise Stepを作ってみた</h2><div class="post-link__site"><img src="https://www.google.com/s2/favicons?domain=qiita.com" width="14" height="14" class="post-link__site-favicon"/>qiita.com</div></a></article><article class="post-link"><a class="post-link__author" href="/members/maguhiro/"><img src="/avatars/megu.jpg" class="post-link__author-img" width="35" height="35"/><div class="post-link__author-name"><div class="post-link__author-name">maguhiro</div><time dateTime="2018-11-21T06:16:47.000Z" class="post-link__date">3 years ago</time></div></a><a href="https://qiita.com/maguhiro/items/c050fb9fa2a8dc5c389d" class="post-link__main-link"><h2 class="post-link__title">CI/CD Test Night 参加レポート #cicd_test_night</h2><div class="post-link__site"><img src="https://www.google.com/s2/favicons?domain=qiita.com" width="14" height="14" class="post-link__site-favicon"/>qiita.com</div></a></article><article class="post-link"><a class="post-link__author" href="/members/maguhiro/"><img src="/avatars/megu.jpg" class="post-link__author-img" width="35" height="35"/><div class="post-link__author-name"><div class="post-link__author-name">maguhiro</div><time dateTime="2018-11-07T03:55:32.000Z" class="post-link__date">3 years ago</time></div></a><a href="https://qiita.com/maguhiro/items/60f3d1cb2e5368928813" class="post-link__main-link"><h2 class="post-link__title">[iOS]macOSのVM環境で特定のstoryboard, xibファイルのコンパイルに時間がかかる問題</h2><div class="post-link__site"><img src="https://www.google.com/s2/favicons?domain=qiita.com" width="14" height="14" class="post-link__site-favicon"/>qiita.com</div></a></article><article class="post-link"><a class="post-link__author" href="/members/maguhiro/"><img src="/avatars/megu.jpg" class="post-link__author-img" width="35" height="35"/><div class="post-link__author-name"><div class="post-link__author-name">maguhiro</div><time dateTime="2018-10-31T03:33:24.000Z" class="post-link__date">3 years ago</time></div></a><a href="https://qiita.com/maguhiro/items/92c4ded090a70f7b6b2e" class="post-link__main-link"><h2 class="post-link__title">Microservices Meetup vol.9 (FiNC App &amp; Frontend) 参加レポート</h2><div class="post-link__site"><img src="https://www.google.com/s2/favicons?domain=qiita.com" width="14" height="14" class="post-link__site-favicon"/>qiita.com</div></a></article></div></div></div></section><footer class="site-footer"><div class="content-wrapper"><p>© <!-- -->Ubie Discovery</p></div></footer></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"member":{"id":"maguhiro","nickname":"maguhiro","realName":"目黒博隆","bio":"4児の父親エンジニア。フロント・バックエンド担当してます。","avatarSrc":"/avatars/megu.jpg","sources":["https://qiita.com/maguhiro/feed","https://note.com/maguhiro/rss"],"twitterUsername":"maguhiro","githubUsername":"maguhiro","websiteUrl":"https://note.com/maguhiro"},"postItems":[{"title":"4児の父親エンジニアの働き方とそれを支える組織文化・制度","contentSnippet":"こんにちは、Ubie(ユビー)株式会社 / Ubie Discoveryでソフトウェアエンジニアをしている目黒（@maguhiro）です。子育てをしながら働かれている世の中のお父さん・お母さん、コロナ禍における仕事・育児の両立いかがでしょうか？リモートワークでお子さんとの関わりも増え充実している家庭もあれば、保育園・幼稚園の登園ルールが厳しくなり両立に悩まれている家庭もあるかと思います。続きをみる","link":"https://note.com/maguhiro/n/nb35bf6c692fe","isoDate":"2021-06-02T23:28:43.000Z","dateMiliSeconds":1622676523000,"authorName":"maguhiro","authorId":"maguhiro"},{"title":"Ubie株式会社に入社しました","contentSnippet":"はじめまして、Ubie(ユビー)株式会社でソフトウェアエンジニアをしている@maguhiroです。Ubie株式会社Ubie株式会社 (Ubie, Inc.) は、「テクノロジーで人々を適切な医療に案内する」をミッションにしたヘルステックubie.life続きをみる","link":"https://note.com/maguhiro/n/nfff34cf4156a","isoDate":"2021-01-19T09:05:19.000Z","dateMiliSeconds":1611047119000,"authorName":"maguhiro","authorId":"maguhiro"},{"title":"RxSwiftのbind関数をCombineで実装してみた","contentSnippet":"今まではRxSwiftを用いて非同期に値の変化を監視して処理を行う実装をしてきましたが、iOS13からCombine Frameworkが使えるようになり同等の処理が行えるようになったので現在勉強をしています。勉強していく中で、RxSwiftのRelay、bind関数を作ってみたので今回紹介します。検証環境Xcode 11.2.1Swift 5.1RxSwift 5.0.1背景元々RxSwiftのbind関数を利用していたコードをCombineで書き換えた所、RxSwiftのbind関数の方が読みやすい(その書き方に慣れているせいか）と感じたので、【Combineでも同じ形式で呼び出せるようできないか？】というのがきっかけとなります。ではまずRxSwiftで実装した例を元に、Combineを使った書き方に書き直してみましょう。具体例姓と名を入力する２つの入力フォームがあり、登録ボタンをタップすると入力した文字列を出力するコードを書いていきます。※bind関数を使った例を書きたいので、登録ボタンタップ時にUITextFieldインスタンスのtextプロパティを参照すればいいじゃんというツッコミはお控えください。RxSwiftで書いた場合以下のように記載できます。各入力フォームのテキストを表すControlPropertyの値がbind(to:)関数で対応するRelayにバインドされるという直感的なコードです。import RxCocoaimport RxRelayimport RxSwiftimport UIKitstruct NameRegisterInputData {  let firstNameTextRelay = BehaviorRelay\u003cString\u003e(value: \"\")  let lastNameTextRelay = BehaviorRelay\u003cString\u003e(value: \"\")}final class NameRegisterViewController: UIViewController {  @IBOutlet private var firstNameTextField: UITextField!  @IBOutlet private var lastNameTextField: UITextField!  private let input = NameRegisterInputData()  private let disposeBag = DisposeBag()  override func viewDidLoad() {    super.viewDidLoad()    setupDataBinding()  }  private func setupDataBinding() {    let firstNameTextControlProperty = firstNameTextField.rx.textInput.text.orEmpty    let lastNameTextControlProperty = lastNameTextField.rx.textInput.text.orEmpty    firstNameTextControlProperty.bind(to: input.firstNameTextRelay).disposed(by: disposeBag)    lastNameTextControlProperty.bind(to: input.lastNameTextRelay).disposed(by: disposeBag)  }  @IBAction private func tapRegisterButton() {    print(\"Input Data: \\(input.firstNameTextRelay.value) \\(input.lastNameTextRelay.value)\")  }}Combineで書いた場合Combineでbind処理を実現する場合にはassign(to:on:)関数を利用します。この関数では、更新するインスタンスを第二引数として指定し、そのインタンスの更新したいプロパティをKeyPathとして第一引数に指定します。import Combineimport UIKitclass NameRegisterInputData {  var firstNameText = \"\"  var lastNameText = \"\"}final class NameRegisterViewController: UIViewController {  @IBOutlet private var firstNameTextField: UITextField!  @IBOutlet private var lastNameTextField: UITextField!  private let input = NameRegisterInputData()  private var cancellables: Set\u003cAnyCancellable\u003e = []  override func viewDidLoad() {    super.viewDidLoad()    setupDataBinding()  }  private func setupDataBinding() {    let firstNameTextPublisher = firstNameTextField.textPublisher.orEmpty    let lastNameTextPublisher = lastNameTextField.textPublisher.orEmpty    firstNameTextPublisher.assign(to: \\.firstNameText, on: input).store(in: \u0026cancellables)    lastNameTextPublisher.assign(to: \\.lastNameText, on: input).store(in: \u0026cancellables)  }  @IBAction private func tapRegisterButton() {    print(\"Input Data: \\(input.firstNameText) \\(input.lastNameText)\")  }}// 以下は、UITextFieldの入力文字列を監視するためのExtensionextension UITextField {  var textPublisher: AnyPublisher\u003cString?, Never\u003e {    NotificationCenter.default      .publisher(for: UITextField.textDidChangeNotification, object: self)      .map { $0.object as! UITextField }      .map { $0.text }      .prepend(text)      .eraseToAnyPublisher()  }}extension AnyPublisher where Output == String?, Failure == Never {  var orEmpty: AnyPublisher\u003cString, Never\u003e {    map { $0 ?? \"\" }.eraseToAnyPublisher()  }}assign(to:on:)関数を用いた記述がまどろっこしく感じたので、CombineでもRxSwiftのようにbind(to:)関数のように呼び出せるようにしていきます。コードリーディングCombine版のRelay,bind関数を実装する前に、RxSwiftのコードを読んでどんな機能を提供しているのか改めて確認してみましょう。RxSwiftのbind関数bind関数は、ObservableTypeの拡張関数として定義され、引数としてPublishRelayまたはBehaviorRelay型のインスタンスを指定し、Disposable型のインスタンス変数を返却していることが分かります。RxSwiftのObservableTypeはプッシュ型のシーケンスを表します。これはCombineのPublisherが該当します。同様にDisposableはdispose関数が定義され、この関数を呼び出す事で現在購読中の処理を終了する事ができます。こちらは、CombineのCancellableが似たような立ち位置で存在します。RxSwiftのRelayしかし、PublishRelayまたはBehaviorRelayに対応する定義はCombineに現在ありません。なので、RelayについてもRxSwiftのコードを読んでみましょう。PublishRelay、BehaviorRelayともにSubjectをラップしている事が分かります。SubjectのonEvent関数を内部的に呼び出すaccept関数の実装もしています。また、BehaviorRelayに関しては、BehaviorSubjectと同様に購読時に現在の値を受け取れる性質があるため、イニシャライザとして初期値を設定できるようになっています。現在値もComputed Propertyとして定義され、取得できるようです。CombineではPublishSubject、BehaviorSubjectに対応する型として、PassthroughSubject、CurrentValueSubjectという型が定義されています。これらの情報を用いて実装できそうですね！次の章では実際にコードリーディングした内容を元に実装をしていきます。実装RelayまずRelayプロトコルを作ります。Publisherプロトコルを継承しますが、エラーイベントは発生させないのでFailureにはNeverという条件を設定します。RxSwift同様にaccept関数を定義しました。Relay.swiftimport Combine@available(OSX 10.15, iOS 13.0, tvOS 13.0, watchOS 6.0, *)public protocol Relay: Publisher where Failure == Never {  func accept(_ event: Self.Output)}続いてPassthroughRelayの実装です。※CombineのSubject名に合わせてPublishRelayではなくPassthroughRelayとしました。先程のRelayプロトコルに適合させ、RxSwift同様にPassthroughSubjectのインスタンスを内部で保持します。あとはaccept関数を実装しつつ、Publisherプロトコルに適合させます。PassthroughRelay.swiftimport Combine@available(OSX 10.15, iOS 13.0, tvOS 13.0, watchOS 6.0, *)public final class PassthroughRelay\u003cOutput\u003e: Relay {  private let subject = PassthroughSubject\u003cOutput, Never\u003e()  public init() {}  public func accept(_ event: Output) {    subject.send(event)  }  public func receive\u003cS\u003e(subscriber: S) where S: Subscriber, S.Failure == Never, Output == S.Input {    subject.receive(subscriber: subscriber)  }}続いてCurrentValueRelayの実装です。※CombineのSubject名に合わせてBehaviorRelayではなくCurrentValueRelayとしました。先程のRelayプロトコルに適合させ、RxSwift同様にCurrentValueSubjectのインスタンスを内部で保持します。PassthroughSubject同様の実装をしつつ、初期値が設定できるイニシャライザの定義と、現在値を取得することができるComputed Propertyの定義も行いました。CurrentValueRelay.swiftimport Combine@available(OSX 10.15, iOS 13.0, tvOS 13.0, watchOS 6.0, *)public final class CurrentValueRelay\u003cOutput\u003e: Relay {  private let subject: CurrentValueSubject\u003cOutput, Never\u003e  public var value: Output {    subject.value  }  public init(_ value: Output) {    subject = CurrentValueSubject(value)  }  public func accept(_ event: Output) {    subject.send(event)  }  public func receive\u003cS\u003e(subscriber: S) where S: Subscriber, S.Failure == Never, Output == S.Input {    subject.receive(subscriber: subscriber)  }}bind関数作成したPassthroughSubjectとCurrentValueRelayを利用してbind関数を実装していきます。RxSwiftのObservableTypeに対応するものがCombineのPublisherであるため、Publisherのextensionとして実装していきます。また、エラーイベントをbind関数では受け取らないようにするために、FailureにはNeverという条件を設定しました。実装の実体についてはRxSwiftの実装を参考に実装しています。Publisher+Bind.swiftimport Combine@available(OSX 10.15, iOS 13.0, tvOS 13.0, watchOS 6.0, *)public extension Publisher where Self.Failure == Never {  func bind(to relays: CurrentValueRelay\u003cOutput\u003e...) -\u003e AnyCancellable {    bind(to: relays)  }  func bind(to relays: CurrentValueRelay\u003cOutput?\u003e...) -\u003e AnyCancellable {    map { $0 as Output? }.bind(to: relays)  }  private func bind(to relays: [CurrentValueRelay\u003cOutput\u003e]) -\u003e AnyCancellable {    sink { value in      relays.forEach { $0.accept(value) }    }  }  func bind(to relays: PassthroughRelay\u003cOutput\u003e...) -\u003e AnyCancellable {    bind(to: relays)  }  func bind(to relays: PassthroughRelay\u003cOutput?\u003e...) -\u003e AnyCancellable {    map { $0 as Output? }.bind(to: relays)  }  private func bind(to relays: [PassthroughRelay\u003cOutput\u003e]) -\u003e AnyCancellable {    sink { value in      relays.forEach { $0.accept(value) }    }  }}使ってみる開発したCombine版Relayを使って先程のassign(to:on:)関数をbind(to:)関数に変更してみました。すると、RxSwiftで書いた場合のようにより直感的なコードで記述できるようになりました。import Combineimport UIKitstruct NameRegisterInputData {  let firstNameTextRelay = CurrentValueRelay\u003cString\u003e(\"\")  let lastNameTextRelay = CurrentValueRelay\u003cString\u003e(\"\")}final class NameRegisterViewController: UIViewController {  @IBOutlet private var firstNameTextField: UITextField!  @IBOutlet private var lastNameTextField: UITextField!  private let input = NameRegisterInputData()  private var cancellables: Set\u003cAnyCancellable\u003e = []  override func viewDidLoad() {    super.viewDidLoad()    setupDataBinding()  }  private func setupDataBinding() {    let firstNameTextPublisher = firstNameTextField.textPublisher.orEmpty    let lastNameTextPublisher = lastNameTextField.textPublisher.orEmpty    firstNameTextPublisher.bind(to: input.firstNameTextRelay).store(in: \u0026cancellables)    lastNameTextPublisher.bind(to: input.lastNameTextRelay).store(in: \u0026cancellables)  }  @IBAction private func tapRegisterButton() {    print(\"Input Data: \\(input.firstNameTextRelay.value) \\(input.lastNameTextRelay.value)\")  }}// 以下は、UITextFieldの入力文字列を監視するためのExtensionextension UITextField {  var textPublisher: AnyPublisher\u003cString?, Never\u003e {    NotificationCenter.default      .publisher(for: UITextField.textDidChangeNotification, object: self)      .map { $0.object as! UITextField }      .map { $0.text }      .prepend(text)      .eraseToAnyPublisher()  }}extension AnyPublisher where Output == String?, Failure == Never {  var orEmpty: AnyPublisher\u003cString, Never\u003e {    map { $0 ?? \"\" }.eraseToAnyPublisher()  }}まとめ今回bind関数をCombineで実装するために、RxSwiftのコードリーディングを行いました。RxSwiftでどのようにbind関数・Relayの実装がされているのかを知る機会となり、非常に面白かったです。また、現状はNotificationCenterでCombineの機能が利用できるもののRxCocoaほどUIイベントのハンドリングは行えないので、RxCocoaのコードリーディングをしながらUIイベントのハンドリングもより簡単に行えるように実装をできればと考えています。明日は@sadashiさんの「Android View Bind Library 比較」です。お楽しみに！","link":"https://qiita.com/maguhiro/items/30b0d99a8f8e35b8e2f7","isoDate":"2019-12-16T04:14:14.000Z","dateMiliSeconds":1576469654000,"authorName":"maguhiro","authorId":"maguhiro"},{"title":"値オブジェクトへのCodable対応 \u003c補足編\u003e #iosdc","contentSnippet":"先日開催されたiOSDC Japan 2019のルーキーズLT枠で値オブジェクトのCodable対応という発表をさせて頂きました。こちらに関して @takasek さんより、以下のようなご指摘・別解の共有を頂いたので、そちらについて記載させて頂きます。すみません、いくつか気になったことが！protocol ValueObjectを作ると、本来のDDD的なValue Object（familyNameとgivenNameを合わせて型表現するなど）の意味が歪んでしまうのを懸念していますまた、protocol ValueObjectでやりたいことはRawRepresentableで実現可能に見えますがどうでしょうか？— takasek (@takasek) September 10, 2019 ValueObjectプロトコルという命名について今回は以下の観点からValueObjectという名前をつけました。値オブジェクトを利用して不適切な利用を防ぎたいsingleValueContainerを利用した実装を共通化したいしかしながら、ご指摘の通り複数のパラメータを保持するようなケース（例えば位置を表す緯度と経度を保持するような値オブジェクト）では適用できません。今回はユーザーIDや写真IDといった一意な識別子を表すIdentifiableが適切だったかと思います。また、一意な識別子という事でDictionaryのキーに使う事も想定されるので、EquatableよりHashableが適切かと思いましたので、以下のように変更してみました。Identifiable.swiftprotocol Identifiable: Codable, CustomStringConvertible, Hashable {  associatedtype Value: Codable, CustomStringConvertible, Hashable  var value: Value { get }  init(value: Value)}extension Identifiable {  init(from decoder: Decoder) throws {    let container = try decoder.singleValueContainer()    let value = try container.decode(Value.self)    self.init(value: value)  }  func encode(to encoder: Encoder) throws {    var container = encoder.singleValueContainer()    try container.encode(value)  }  var description: String {    return value.description  }}RawRepresentableを用いた別解法教えて頂いたやり方を早速検証してみようと思ったところ、 @Mt-Hodaka さんが CodableでのValueObject利用 というタイトルで、RawRepresentableを用いた実装方法をまとめて頂いておりました。こちらも参考にし、先程の例のようにIdentifiableプロトコルを作ってみたいと思います。まず、Codable, CustomStringConvertible, Hashableのプロトコルを適用していきます。RawRepresentableのオフィシャルレファレンスに記載の通り、自分自身(Self)とRawValueがEncodable, Decodable, Hashableプロトコルに適合していると、それぞれのプロトコルのデフォルト実装がされるようです。一方でCustomStringConvertibleプロトコルはRawRepresentableでデフォルト実装はされていないので、Identifiableプロトコルを作成する場合には、デフォルト実装が必要になります。上記を元に新しく作成したIdentifiableプロトコルがこちらです。Identifiable.swiftprotocol Identifiable: RawRepresentable, Codable, CustomStringConvertible, Hashable {}extension Identifiable where Self.RawValue : CustomStringConvertible  {  var description: String {    return rawValue.description  }}サンプルコードに適用struct UserID: Identifiable {  let rawValue: Int}struct User: Codable {  let id: UserID  let name: String  let age: Int}let json = \"\"\"{  \"id\" : 1234,  \"name\" : \"maguhiro\",  \"age\" : 34}\"\"\".data(using: .utf8)!let user = try! JSONDecoder().decode(User.self, from: json)print(\"\\(user.id)\") // 1234let encodeJson = try! JSONEncoder().encode(user)print(String(bytes: encodeJson, encoding: .utf8)!) // {\"id\":1234,\"name\":\"maguhiro\",\"age\":34}let a = UserID(rawValue: 1)let b = UserID(rawValue: 2)let c = UserID(rawValue: 1)print(a == b) // falseprint(a == c) // truevar map = [UserID: Int]()map[a] = 2map[b] = 10map[c] = 100print(map) // [2: 10, 1: 100]自分の発表資料に記載したコードより、シンプルになりましたね！謝辞ご指摘頂いた事で考慮が足りていなかった部分を理解することができ、また、自分が知らなかった解法も学ぶことができました。@takasek さん、 @Mt-Hodaka さんありがとうございました！！また、今回iOSDC Japan 2019にて登壇する機会を提供頂きありがとうございました。スタッフの皆様、参加者の皆様ありがとうございました！！","link":"https://qiita.com/maguhiro/items/065de506969fcd68a8de","isoDate":"2019-09-10T16:21:18.000Z","dateMiliSeconds":1568132478000,"authorName":"maguhiro","authorId":"maguhiro"},{"title":"iOS Test Night 第9回目 参加レポート #ios_test_night","contentSnippet":"イベント情報iOS Test Night #9 - 2周年 -会場: DeNAさんのサクラカフェURL: https://testnight.connpass.com/event/102778/トークXCTest（再）入門@tobi462さんTDDテスト駆動開発良い設計とはテストしやすいことBDDTDDから派生振る舞い駆動開発XCTestXCTAssertEqual他にもアサーションは沢山あるXCTestCaseを継承test_から始まる関数名である必要があるエラーメッセージ任意で付与可能全部書かず、バランスが必要BDDの場合は自動生成されるのでそちらに任せるとよい@testable import でinternalな関数にもアクセスできる独自アサーションXCTestfile, lineを引数を渡し、エラーメッセージを設定するQuick/Nimble前後処理の共通化XCTestsetUp/tearDownQuick/NimblebeforeEach/afterEachテストの階層化・カテゴライズXCTestXcode9から追加されたrunActivity(name:)BetterSpecsに学ぶ Swiftにおける本当にRSpecライクなテストの書き方@rocknameさん資料みてねではテストを書く文化があるDangerを利用し、テスト書いてないとbotに怒られるQuick/Nimbleを採用サーバサイドがRSpecなので、RSpecにインスパイアされているものを採用Mock用ライブラリは特に使っていない読みやすいテストを書きたいBetter Specsというガイドラインを参考にしているBetter Specs単一条件テストitで テストに対する説明をしっかり書いてあげるどういう仕様に対して、どういう値を返すのか明確になるContextsを使う例えば、ログインしている、ログインしていないという文脈をContextsに外側に切り出すSubjectを使うテスト対象の主体をSubjectとするQuickだと用意されていない引数を変数として定義subjectを計算型プロパティとして定義するSubjectは毎回代入する必要がなくなるWhat/When/Howを意識する【Spec = 仕様書】になるようにAzure PipelinesでiOSアプリのCI/CDを実現@nakashoさん資料Azure DevOps2018/9/11に発表Azure Pipelinesの話ソース選択ビルドテンプレートの選択様々な拡張機能のあるMarketplaceもあるよく使うテストヘルパーの紹介@ktanaka117さん資料やりたいことは事前準備ではなくテストよく使うテストヘルパーJSONファイルからテストデータを取得するテストデータに不備がない前提でforce tryしている連続した通信で順番を担保しつつResponseを返すHTTP Stub指針重複の削除テストの本質でないものは目立たせない理想の形（テストコード）を先にイメージして、インターフェース化するヘルパーに対してもテストを書く開発者として学ぶソフトウェアテスト@kariadさん資料どこまでテスト書けばいけばいいのかわからなくなったソフトウェアテストの７原則参考記事テスト設計何を優先するか？どうやって実施するのか？どの条件でテストするのか？テスト技法条件をより少ないケースでより効率的になるべく網羅的にテストするテスタビリティテスト前提の設計をしようテストを何で学ぶかJSTQBはじめて学ぶソフトウェアのテスト技法TDD Boot Campソフトウェアテストの重要性とテストでの考え方まずはできるところから始めるUnitTestとテストができる実装について@fumiyasacさん資料目視チェックはしんどい仕様の概略とテスト戦略を考える紛らわしい検索条件の組み合わせのテストパターンを入れる些細なtエストコードが実装や理解の助けになる最初からうまくはいかない。できる所から試していこうまとめ自分自身テストコードをどんどん書いていきたいと思いながらもなかなか実現できていない状況なので、まずはどういう所から書いていけばいいか・書く時はどのような所を意識して考えていけばいいかなどすぐに実践に移せそうな内容で参考になりました。勉強会全体を通して初心者にもとっつきやすい内容が多い印象でした。Better Specsというガイドラインは今回初めて知ったので、是非読んでテストコードを書くための理解を深めたいと思います。素晴らしい発表ありがとうございました。","link":"https://qiita.com/maguhiro/items/b1a941a13d14abf8424f","isoDate":"2018-12-11T04:34:29.000Z","dateMiliSeconds":1544502869000,"authorName":"maguhiro","authorId":"maguhiro"},{"title":"MS Teamsへのメッセージ送信用Bitrise Stepを作ってみた","contentSnippet":"食べログ アプリDevOpsチームの @maguhiro です。Advent Calendar 17日目の記事では、Microsoft Teamsへのメッセージ送信を行えるBitrise Stepを作った際のノウハウを共有したいと思います。はじめに食べログのスマホアプリ開発ではCI/CDツールとしてJenkinsを利用していました。しかしながら、以下のような理由から他のCI/CDツール・サービスへの移行を決断しました。定期的なビル停電に伴い利用不可となるタイミングが発生Xcodeのバージョンアップに伴うメンテナンス対応コストJenkins運用の属人化他ビルドへの副作用を及ばさないようなジョブ設計CI/CDの利用拡大に伴うジョブキュー滞留これらの問題を解決するためBitriseを選択しました。CircleCIも候補に挙がりましたが、Xcodeのバージョンアップ対応の迅速さからBitriseを選定しました。Bitriseのワークフロー(Jenkinsで言うところのジョブ)はステップという処理単位の連なりで構成されます。ワークフローのステップはGUIで簡単に追加・削除・順序変更が行えます。ステップの一例としてはGit Clone, fastlaneのlane実行, TestFlightへのデプロイ, Slackへのメッセージ送信などがあります。これらのステップはOSSとして公開され、個人でも開発することができます。食べログではチャットツールとしてMicrosoft Teams を利用しているのですが、Microsoft Teamsへの柔軟なメッセージ送信が可能なBitrise Stepが存在していなかったので今回自分で作成してみることにしました。※Bitrise StepはGo(golang)またはbashで実装することができるため、今回は初めてGoを使って開発してみました。作成するにあたって以下のページやスライドを参考にさせて頂きました。Microsoft Teams Incoming WebhookMicrosoftオフィシャル - MessageCard ReferenceBitrise Step作成Bitriseオフィシャル - Creating and sharing your own StepBitriseオフィシャル - Steps in YAMLBitrise Stepの作り方 by @wakwak3125さんsteps-slack-messageSlackへのメッセージ送信用Bitrise Step今回はこちらの実装を写経しながらGoの書き方を把握し、Teams用にカスタマイズ実装させて頂きました作成手順1. Bitrise CLIのインストール・セットアップHomebrew経由でのインストール手順となります。$ brew update$ brew install bitrise$ bitrise setup$ bitrise plugin update step2. Stepの新規作成以下のコマンドを叩くと対話式に入力を行い、ステップの作成をすることができます。入力項目作者ステップ名 サマリー ステップの詳細内容 カテゴリ 実装する言語 Github上でリポジトリを作成するユーザー or 組織名$ brew :step createWho are you / who's the author? [maguhiro] : maguhiroWhat's the title / name of the Step? : Send Microsoft Teams messageGenerated Step ID (from provided Title): send-microsoft-teams-messagePlease provide a summary : Send Microsoft Teams message to a channelPlease provide a description : Send Microsoft Teams message to a channelWhat's the primary category of this Step?Please select from the list:[1] : access-control[2] : artifact-info[3] : installer[4] : deploy[5] : utility[6] : dependency[7] : code-sign[8] : build[9] : test[10] : notification(type in the option's number, then hit Enter) : 10Toolkit: the entry/base language of the Step.Our recommendation is to use Bash for very simple Steps and for more complex ones use another language, one which we have toolkit support for.If you're just getting started with Step development our suggestion is to select Bash, as that's the easiest option. It's possible to convert the step later, if needed.Note: Of course even if you select e.g. Bash as the entry language, you can run other scripts from there, so it's possible to write the majority of the step's code in e.g. Ruby, and have an entry Bash script which does nothing else except running the Ruby script.Which toolkit (language) would you like to use?Please select from the list:[1] : bash[2] : go(type in the option's number, then hit Enter) : 2Website \u0026 source code URL:Will you host the source code on GitHub? [YES/no]: YESWhat's your GitHub username (user/org where you'll register the step's repository)? : maguhiroWe'll use https://github.com/maguhiro/bitrise-step-send-microsoft-teams-message as the website/repo URL for this step.Please when you create the repository on GitHub for the step create it under the user/org: maguhiro and the name of the repository should be: bitrise-step-send-microsoft-teams-messageCreating Step directory at: /Users/maguhiro/go/src/github.com/maguhiro/bitrise-step-send-microsoft-teams-message * [OK] created: /Users/maguhiro/go/src/github.com/maguhiro/bitrise-step-send-microsoft-teams-message/README.md * [OK] created: /Users/maguhiro/go/src/github.com/maguhiro/bitrise-step-send-microsoft-teams-message/LICENSE * [OK] created: /Users/maguhiro/go/src/github.com/maguhiro/bitrise-step-send-microsoft-teams-message/.gitignore * [OK] created: /Users/maguhiro/go/src/github.com/maguhiro/bitrise-step-send-microsoft-teams-message/step.yml * [OK] created: /Users/maguhiro/go/src/github.com/maguhiro/bitrise-step-send-microsoft-teams-message/bitrise.yml * [OK] created: /Users/maguhiro/go/src/github.com/maguhiro/bitrise-step-send-microsoft-teams-message/.bitrise.secrets.yml * [OK] created: /Users/maguhiro/go/src/github.com/maguhiro/bitrise-step-send-microsoft-teams-message/main.goInitializing git repository in step directory ... $ git \"init\" $ git \"remote\" \"add\" \"origin\" \"https://github.com/maguhiro/bitrise-step-send-microsoft-teams-message\"Step is ready!You can find it at: /Users/maguhiro/go/src/github.com/maguhiro/bitrise-step-send-microsoft-teams-messageTIP: cd into /Users/maguhiro/go/src/github.com/maguhiro/bitrise-step-send-microsoft-teams-message and run bitrise run test for a quick test drive!3. Goの依存関係管理ツールdepのインストールBitriseではGoで簡単にStepが開発できるようにライブラリを公開しています。go-utilsgo-steputilsそのライブラリを利用できるように依存関係管理ツールdepを今回はインストールします。$ brew install dep$ cd /Users/maguhiro/go/src/github.com/maguhiro/bitrise-step-send-microsoft-teams-message$ dep init # Gopkg.lockファイル, Gopkg,tomlファイル, vendorディレクトリが作成されます$ vim Gopkg.toml # 依存関係を記述し、保存してください$ dep ensure # Gopkg.lock, vendor配下が更新される※本来vendor配下はGit管理不要かもしれませんが、Bitrise Stepではvendor配下もGit管理してください。4. Input\u0026Outputの定義先程自動生成されたファイル step.yml を編集することになります。step.yml の書き方は こちら を参考にしてください。このymlファイルで設定したInputがステップの入力フォームとなり、Outputが後続ステップで利用可能となる環境変数を表します。5. 実装先程自動生成されたファイル main.go を編集することになります。Input情報を元に処理したい内容をこのファイルに記載してください。※もちろん必要に応じてファイルを分割しても構いません。6. テスト以下のコマンドを実行します。$ bitrise run testこのコマンドは先程自動生成されたファイルbitrise.yml のworkflows の testワークフローの記述内容を元に処理を実行します。Inputの定義変更に合わせてこちらのファイルのtestワークフローの処理内容も変更してからコマンドを実行してください。ちなみに私が今回作成したコマンドは先行ステップが全て成功した場合、いずれかのステップが失敗した場合に合わせてテストワークフローを2つに分けております。なので、今回私が作成したステップの場合には、テスト実行コマンドは以下のようになります。$ bitrise run success-test$ bitrise run fail-test7. 共有今回作成したステップをBitrise Workflow上で利用できるようにするためにはBitriseの審査が必要となります。審査に出すまでの手順は以下の通りです。https://github.com/bitrise-io/bitrise-steplib をforkする新規作成したStepリポジトリでバージョンに対応するタグを切る※Stepバージョンが【0.0.1】であれば、タグ【0.0.1】を作成してください以下のコマンドを実行$ bitrise run share-this-stephttps://github.com/bitrise-io/bitrise-steplib に対して forkしたリポジトリ(ブランチ)からPRを出す※PRがマージされるとBitrise Workflow上で利用できるようになります使い方現在、PRを投げております。https://github.com/bitrise-io/bitrise-steplib/pull/1826こちらがマージされるまでBitrise Workflow設定画面からは利用できません。マージされましたら、こちらは更新致します。最後に今回開発したBitrise StepをOSSとして公開しました。MS Teamsを利用されている方は利用して頂けると幸いです。明日の18日目は@zettaittenaniさんより「Rails の session を完全に理解した」です。お楽しみに！","link":"https://qiita.com/maguhiro/items/fdeab3efdcbc8a4ed545","isoDate":"2018-12-10T09:30:56.000Z","dateMiliSeconds":1544434256000,"authorName":"maguhiro","authorId":"maguhiro"},{"title":"CI/CD Test Night 参加レポート #cicd_test_night","contentSnippet":"connpassページ 1日目connpassページ 2日目はじめにBitriseを利用する機会が増えもっと理解を深めていきたいと考えていた矢先に、Bitrise社の方々が来日されお話をされるという事でその勉強会に参加してきました。勉強会からだいぶ経過していますが、せっかくなので参加レポートを書きます。1日目トークKeynote@ViktorBeneiさん(Bitrise CTO)Bitriseの紹介以前はアプリ開発を沢山やっていた社内の問題解決のために作ったBitfallという名前からBitriseという名前となった現在の社員数は40名程度Bitrise利用者を国別で順位付けすると日本は第3位。2019年初頭には世界第2位になる見込みsteps-project-scannerリポジトリiOS,Android,ReactNativeのプロジェクトをスキャンするOSSワークフロー何をするかを定義するものビルド、テスト、デプロイ等ステップの組み合わせによって構築されるbitrise-workflow-editorリポジトリGUIでステップ処理とその順番を定義することができるステップはライブラリから追加することが可能ステップ例Bitriseのキャッシュを取得するステップ独自のスクリプトを叩くことができるステップBitriseに成果物をデプロイするステップコードサインKeyStoreやプロビジョニングプロファイルをアップロード可能その他にも５MBまでならファイルをアップロード可能EnvVars環境変数をキーバリュー形式で保存可能Secrets機密情報をキーバリュー形式で保存可能Triggersプッシュやタグ作成、PRベースで特定のワークフローを自動実行することができる作成したトリガー順に判定し、最初に合致したトリガーに対応するワークフローを実行する任意の文字列に合致させたい部分は*で表現できるStackビルドする環境を選択することができるXcodeやmacOSのバージョンをワークフロー毎に設定することができる約２年半分の環境があるbitrise.yml設定ファイルの実態はymlファイルで管理できるymlファイル上でワークフローやTriggers、EnvVarsの修正を行うことも可能ymlファイルのチェックを行い正しくない変更が入っている場合は保存できないYAML diffビルド毎のymlファイルと現在のymlファイルの差異を閲覧することができるステップと統合コミュニティにより作られたステップも数多く存在する自分自身のステップを作成することができるhttps://devcenter.bitrise.io/bitrise-cli/create-your-own-step/トラブルシューティングiOSアプリのCodeSigningの事例自分はfastlaneに任せているので気にしたことないAndroid Firebase Test Lab複数クリックで設定ができるアナウンス、Q\u0026ABitriseのドキュメントを日本語訳をヘルプ募って作ったhttps://github.com/bitrise-io/devcenter/tree/master/_articles/translationsContribute用のSlackチームを作る予定日本での採用開始Budapest or Tokyoイベントのスポンサーとしても日本でやっていきたいアプリ周辺ツールのサポートは？Swaggerのコード生成とかスクリプト書くことで対応することが可能成果物もダウンロード可能デバイステストはβ版だが将来有料になるか？今のところは無料だが、将来はわからない処理の並列実行特定のステップ使えば実現可能Bitriseの社内提供へ ~Github Enterpriseとの連携~@hisa9chiさん資料自動テストのサポートチームに所属されている方Bitriseの導入経緯CircleCI Enterpriseを元々利用していたLinux／iOS版を契約していたXcodeの最新バージョン提供スピードが遅いiOS　VMイメージ切り替えのメンテが大変ビルド停止時間が数日できてしまう運用負荷・有効に使えない一方でBitriseはモバイル向けで注目されていたXcodeのバージョンアップ対応も早いEnterprise版ではないので、運用コストが低いVPNを利用して連携しているAWSにVPNを貼っているVPN証明書を担当チームが発行しているCLIツールを作り、VPN証明書やGithubAPITokenとかもで対話的に設定できるようにしているbitcode を有効にしたアプリでも dSYM のアップロードを自動化する@qmiharaさん資料iOSアプリエンジニアを対象に、bitcode対応している人のアンケートを取ったら半分くらいだった意外と少ないfastlanedownload_symbolsupload_symbols_to_crashlyticsBitriseでワークフロー作るさきほどのfastlaneのレーンを指定自動化AppStoreConnectの処理が完了したメールが届いたらGoogle Apps Scriptを利用しているメールをフックする仕組みはなさそうなので、スケジューリングしているBuild Trigger APIを使っているこのトークの最中にTwitter上では、【GASを使ってAppStoreレビューを監視しているよ】という方もいて気になったゼロからはじめない方がいい iOSアプリのビルドシステム構築@dotrikunさん前職でMonacaというサービスを開発していた時の裏側をお話されていた。サービス自体知らなかったので、詳細はあまり理解できなかったがビルドをMacMiniで捌いていたというのはちょっと驚いた。Track Everything -すべてをGitHub/Bitriseで追跡可能にする-@k_katsumiさん資料FOLIOの利用例ユニットテストプロダクション版の生成・配布ベータ版の生成・配布ライブラリアップデートfastlaneの更新があれば、勝手にPR作ってくれるスケジューリングジョブで毎日実行ライセンス情報の更新も↑の感じでlintチェックdsymのアップロードCI導入メリット再現性　記録　可視化 手元のビルド以外はすべてCIでPRを起点に発火するワークフローを構成管理する個人の作業を再現可能にする可視化再現性分業可能初見に優しい手作業でやるとコンフィグレーション間違いコミット漏れどのブランチから実行したか曖昧PR作成はSlackのボットでhttps://github.com/kishikawakatsumi/deliverbot誰かが作業を始めたの可視化できるワークフローのジョブ失敗も可視化できる前回のタグから入ったコミットログをタグにすべて記載するように合わせて対応しているバージョン番号はSlack botが勝手に上げてくれているFOLIOは数字だけみたいリリースノートの更新もここで自動で行えるようにPRつくったときにコミットログも記載していて、release_noteのログはdeliverでmeta dataの差分をとってますTipsAuto Provisionが便利ワークフローでビルド環境を変更することができるWorkflow、どう組んでいますか？@Horie1024さん資料どう組んでいるか？高品質なアプリを迅速に届ける十分なテストが必要テスト戦略The Testing Pyramidユニットテストのような小さなテストを頻繁に実行ワークフローユニットテストは頻繁に実行UIテストは段階的に実行指針が必要デプロイメントパイプラインの概念導入モデル化コミットステージ受け入れテストステージ手動テストステージリリースステージサイボウズの CI/CD 事情 ～Jenkins おじさんは CircleCI おじさんにしんかした！～@miyajanさん資料JenkinsなんでもできるCircle CIPerformance Pricing Plan重量課金コンテナー数ほぼ無限リソース可変ver2.1構文増えて、ステップの再利用もhttps://www.kaizenprogrammer.com/entry/2018/10/01/035657Wantedly Peopleのアプリのリリースワークフロー@wakwak3125さん資料リリースブランチ作成時にやっていることAPKのアップロードアーキテクチャ別（arm64, armeabi）に作成しているマッピングファイルのアップロードビルドURLを表示差分のURLを表示差分が多いと大変なので、どのPR一覧出すとかの方がよさそうGithub Releaseを作るBitriseのステップfastlaneのアクションSlack botOutgoing Webhooksを利用して、apkをGithub Releasesからダウンロードし、GooglePlayへアップロードできるようにしているDownload from Github ReleasesGithub Releasesから該当のタグのアセットファイルを全てダウンロードできるBitriseのステップ2日目トークKeynote@ViktorBeneiさん(Bitrise CTO)Automate EverythingCLIローカル実行も可能init, runアクションがあるSourceryメタプロbitrise.ymlをリポジトリで保存することもできるhttps://devcenter.bitrise.io/tips-and-tricks/use-bitrise-yml-from-repository/ローカルでデバッグも可能DangerBitrise上でも利用可能コードチェックに何をチェックするのかを指定できるPRのチェック、ユニットテストの実行Auto ProvisionBitrise.io API並列実行パラメータを渡すこともできる途中で処理失敗しても成功とさせたい場合Flankテストの並列実行、時間削減テスト分割レポート作成テストシャーディングRoadmapFirebaseのアカウントなしでテストを行えるようにできるDashboardのUI改善ローディング時間の改善Organizationの管理オープンソースサポートチーム管理２FAの強制SAML SSONew Build Systemlinuxはもう使っていて、1,2分の短縮できているfor EnterpriseHostingPerformanceSupport２４時間３６５日英語以外のサポートも・日本語もSecurityアナウンス・Q\u0026Aプライベートクラウド　日本のデータセンターを東京の置く検討もGithub Checks対応も予定しているFirebase TestはBitrise経由だと無料で使える。ただし、時間の制限はあるCI/CD Test on ReRep@Spring_MTさん資料開発ポリシー存在する便利なツール・サービスは利用するFastly, CircleCI, Bitrise, Sentry, Firebase とかを使っているAPI Spec Driven DevelopmentSwaggerを使っている環境の同一性ストーレス、かつ、変更不可能なビルド成果物成果物の管理リポジトリへのpushをトリガに全ての成果物を保持している(ipa, apk)CI成果物の作成テストの実行成果物の保持テストクライアント側のユニットテストはまだできていないCDまだできていない私とBitriseとCircleCI - 私がAndroid CI/CDを移行して得られたもの -@tadashi0713さん資料Bitriseに任せていることビルドPlay Storeへのアップロード目的コスト削減オペミス防止BitriseからさらにCircle CI 2.0へ移行BitriseはGUIでさくっとワークフローが作れるので、プロジェクト初期は素早くCI/CD導入できるただ、GUIに頼りすぎるの辛い部分もでてくるローカルで実行できないfastlaneを使いながら、徐々にコード化していこうCircle CIだとジョブの並列実行もより柔軟に行えるので、チーム・組織に合わせて柔軟に選択できるとよいアプリの検証がどのくらい行われているか調べてみた@henteko07さんDeployGateのデータを元にどのくらいアプリの検証が行われているかを推測ストアの上位アプリだと、1日100回以上もインストールが行われているその分、検証が行われていると推測全体アプリだと、1日2回も満たない品質を高めるために、フィードバックをもらう機会を増やしましょうReact NativeアプリをBitriseでCDする@L_e_k_oさん資料BitriseでやってることPRマージでDeployGateへのデプロイ実施タグ作成をトリガーにGooglePlayへのアルファ版アップロードAppStoreConnectへのモジュールアップロードCircle CIでやっていることプッシュをトリガーにテスト実施手動でやっていること審査ボタンをクリックテストは大事テストを書く時間がないので はなく、テストを書かないから時間がなくなるのです社内ライブラリの更新を自動化する話@wakwak3125さん資料2日連続での登壇！DesignSystemというライブラリを開発中デザインの共通化Color, TextStyle, ButtonとかAtomic Designを用いるAtom, Moleculeまで対応UIに関する共通言語Multi PlatformiOS,Android,ReactNative,React考える必要のあることRepositoryどこにライブラリを配信するか？AWS S3を使っているGradleもS3対応している社内ネットワークからのみアクセスできるようにしている社外からはVPNを経由CIからはクレデンシャルをSecretsから取得Update常に安全に最新版を使いたい更新に気づけるUIテストを実行できるCHANGELOGも把握したい今後やっていきたいiOS側にも展開DesignSystem自体の更新を自動化CI/CD専用モニタと心理的安全性@nakasho_devさん資料CIの価値のうち、あまり意識されていないものプロジェクトの可視性改善ソフトウェア製品に対する開発チームの自信を深めるCI/CD用モニタチーム全員が状況を一目で把握できるタスクが動いていることで、前に進んでいることが分かり自信が持てるタスクが正常終了すると安心できる問題が発生した場合に、誰かがすぐ気づけるコミュニケーションも生まれるチームの心理的安全性が高まるまとめ他社でどのようなワークフローを作成して自動化しているのかという事例を聞くことができ大変参考になりました。ローカルでの実行・別CIサービスへの移行も念頭において、fastlaneを利用してビルドやアーカイブをし、Bitriseにしかできないこと(Bitrise Cacheとか)はBitriseに任せるという方針で自分は考えていましたが、他社さんも比較的同じ考えをされているようでした。GASを利用したdSYMのFabricアップロードはとても参考になったので自分も導入してみようと思います。素晴らしい発表ありがとうございました。","link":"https://qiita.com/maguhiro/items/c050fb9fa2a8dc5c389d","isoDate":"2018-11-21T06:16:47.000Z","dateMiliSeconds":1542781007000,"authorName":"maguhiro","authorId":"maguhiro"},{"title":"[iOS]macOSのVM環境で特定のstoryboard, xibファイルのコンパイルに時間がかかる問題","contentSnippet":"概要iOSアプリのアーカイブ自動化の目的のためモバイル用のCIサービスであるBitriseを利用してみました。アプリ、ワークフローの作成を済ませビルドを行ってみると特定のstoryboard, xibファイルのコンパイルに17分程度の時間を要することが分かりました。ローカルマシンのMacではそういった問題は発生せず、該当ファイルは1秒もかからずにコンパイルが完了していました。特定のstoryboard, xibファイルの共通箇所を見つけて修正した所、上記問題が解決したのでその原因と対応をまとめたいと思います。環境ローカルマシンのMacmacOS High Sierra 10.13.6Xcode 9.4.1BitriseのVM環境 のMacmacOS High Sierra 10.13.5Xcode 9.4.1調査したこと特定のstoryboard, xibファイルを調査した所、Text属性がAttributedとなっており、フォントとしてはHiragino Sans CNSが設定されているUILabelが共通して存在している事が分かりました。この内容を元にググると似たような事象がでてきました。fastlane+bitrise+deploygateでCI環境をつくるHow to use custom fonts in attributed text in labels in Storyboard?どうやらBitriseでビルドする際に存在しないカスタムフォントを利用していると固まる事象が起きるそうです。それを解決するには該当のカスタムフォントファイルをアーカイブ前に実行マシンにインストールすればよいとの事です。ここでふとあれ、そもそもローカルマシンで【Hiragino Sans CNS】なんていうフォントインストールした記憶ないけど…という疑問が沸いて来ました。そもそもフォントファイルがどこに格納されているか調べてみると、こちらに記載がある通り以下のようになるようです。/System/Library/Fonts削除や使用停止に出来ない/Library/Fonts削除や使用停止に出来る/System/Library/Assets/com_apple_MobileAsset_Font4必要に応じてダウンロードや削除、使用停止に出来るこのパスはmacOS High Sierraの場合となりますmacOS Mojave だと /System/Library/Assets/com_apple_MobileAsset_Font5 になるようですmacOS High Sierraのデフォルトインストールフォントの一覧がAppleのサポートページに記載されています。こちらのページを覗いてみると、Hiragino Sans CNSはダウンロードして使えるフォント一覧に含まれていました。つまり、/System/Library/Assets/com_apple_MobileAsset_Font4配下にあることとなります。以下のコマンドをローカルマシンで叩いてみると確かに該当のフォントファイルが存在していることが分かります。$ cd /System/Library/Assets/com_apple_MobileAsset_Font4$ find . -name \"Hiragino*\"./f49eecf252fb0fa3485147173cadc8dfe5f10d74.asset/AssetData/Hiragino_Sans_CNS.ttc同様に/System/Library/Assets/com_apple_MobileAsset_Font4配下には様々なカスタムフォントファイルが存在していることが分かりました。自分でこんなにカスタムフォントをインストールした記憶はやはりないので、もうちょっと調べてみるとこちらのページに以下の記載がありました。実は実機と仮想環境との2台で確認したんですが、仮想環境のほうはOSインストール直後段階ではAssetsにフォントがインストールされなかったこの内容から推測すると恐らくローカルマシンのMacでは出荷時点で既にダウンロード可能なフォントもインストール済みなのかもしれません。※実際に出荷直後、または、初期化直後のマシンの中を確認した訳ではないので不正確な情報かもしれません。一方、仮想環境ではインストールされていなかったという記述があったので、BitriseのワークフローにScriptステップを追加し、以下のコマンドを叩いてみました。$ ls -l /System/Library/Assets/com_apple_MobileAsset_Font4total 272-rw-r--r--  1 root  wheel  136411 Oct 31 03:43 com_apple_MobileAsset_Font4.xml$ ls -l /System/Library/Fontstotal 884056-rw-r--r--  1 root  wheel     266008 Jul 31  2017 Apple Braille Outline 6 Dot.ttf︙$ ls -l /System/Library/Fonts | wc -l115$ ls -l /Library/Fontstotal 251376-rw-r--r--  1 root  wheel    131264 Aug  8  2017 Al Nile.ttc︙$ ls -l /Library/Fonts | wc -l181結果としてやはり/System/Library/Assets/com_apple_MobileAsset_Font4配下にHiragino Sans CNSフォントは存在していませんでした。他のシステムフォントはローカルマシンと同様の結果であることも確認できました。追加検証Hiragino Sans CNSは削除可能なフォントであるので、ローカルマシン上から削除して同様にビルドしたらどうなるのかを検証してみました。※該当フォントの削除はアプリケーション【Font Book】から行うことができます。すると、同様に該当のstoryboard, xibファイルがコンパイルされる際に以下のようなポップアップが表示されました。このポップアップを無視して放置していると、Bitrise上でのアーカイブ処理と同様に17分程度経過すると、該当ファイルのコンパイルは終了することがわかりました。また、Hiragino Sans CNSが削除された状態で該当のstoryboard, xibファイルをInterface Builderで表示してみると、以下のようなモーダルが表示されます。Font “HiraginoSansCNS-W3” does not exist on this system, substituting the system font instead. Saving the document will lose the original font reference.ここの文章に着目すると、該当のフォントが存在しない場合には代わりにシステムフォントが利用されることが分かりました。今回の対応・まとめ今回はそもそもフォントHiragino Sans CNSを利用する想定では無かったので、こちらのフォントを本来のフォントに変更して対応しました。該当ファイルの作成時点で、変なフォントを設定していた事を反省しなければなりません…仮に上記フォントを利用する場合、Bitrise側でVM環境にフォントをインストールするステップを追加したとしてもiOSのフォント一覧にも含まれていないので、システムフォントに切り替わって表示されてしまうかと思います。本当にこのフォントを利用したい場合には、iOSアプリのリソースとして追加しておく必要があるかと思います。","link":"https://qiita.com/maguhiro/items/60f3d1cb2e5368928813","isoDate":"2018-11-07T03:55:32.000Z","dateMiliSeconds":1541562932000,"authorName":"maguhiro","authorId":"maguhiro"},{"title":"Microservices Meetup vol.9 (FiNC App \u0026 Frontend) 参加レポート","contentSnippet":"connpassページはじめに今回クライアントサイド視点から見たマイクロサービスに関するトークということで、スマホアプリ開発を担当している自分にとっても興味がある内容でしたので参加してきました。スマホアプリ開発に関連するトークを中心に感じたことを記載していきます。トークウェルカムトーク「マイクロサービスとクライアント: 理想と現実の狭間で」@qsonaさん資料マイクロサービスの良さ技術異質性回復性デプロイの独立小さく自立・独立した組織エンドユーザーはマイクロサービスを見たいわけではなく、統合された体験を望んでいる結合レイヤーを理解して、適切に対応する必要がある コミュニケーション・責任の所在の明確化・優先順位付けフロントエンドエンジニアはエンドユーザーを最も強く意識する紹介された記事社内の“ハブ”として機能するフロントエンドエンジニアリング　by FOLIO　倉見さんの記事Backends For Frontends(BFF)Micro Frontendsクライアントサイドから考えるマイクロサービス@neonankitiさん資料サーバサイドがマイクロサービス化されていっても、クライアントサイドの実装コストはほぼ変わらないただし、1画面でコールするAPI数は増える運用面の問題はある各サービス間のリソース表現が異なるスマホアプリ側では同じリソースは同じモデルとして扱いたい腐敗防止層の設置シェアと合意形成のため、同一職能(iOSエンジニア・Androidエンジニア)でのコミュニケーション強化iOS/Androidエンジニア間での設計齟齬・ドメインモデル差異・会議に両エンジニアが必須iOS/Androidエンジニア間のコミュニケーション橋渡しのためClient Fusionを導入各テックリードエンジニアが戦略を立て、アプリエンジニア全体定例でシェアをする即効性は無いが、徐々に効果が出てきているマイクロアプリ化クライアントアプリ内の分割されたマイクロサービスドメイン毎のアプリインストール自律性AndroidアプリはInstant Appsを利用すれば実現可能マルチモジュールマルチモジュールのすゝめ by @kgmyshinさんマイクロアプリは近い未来にくるAndroidアプリはマルチモジュールやInstant Appsがあるが、iOSはまだ難しいのでは？マイクロサービスとクライアントとコンテキスト境界@takasek さん資料クライアント・サーバ間のコンテキスト境界をどこに置くかBFFの場合整合性についての心配事をドメインから排除プラットフォーム間での重複実装排除分散コンピューティングの原則への挑戦Repository整合性についての心配事をドメインから排除データの永続化・隠蔽を担うRepositoryがビジネスロジックも保有プラットフォーム間での重複実装UseCaseビジネスロジックを実装する層でもあるのでしっくりくるプラットフォーム間での重複実装ViewModel責務の肥大化ViewViewはマイクロサービスではない。エンドユーザーは統合された体験を望んでいる。クライアントが担保すべき整合性Model と View 間の整合性Model と Model の整合性クライアントが保持しているサービスの状態はスナップショットでしかないクライアントはマイクロサービス間の関係性の知識を持たざるを得ない「ビジネスロジック」の定義はアプリ・サービスによって異なる実践、BFF ~ BFFはFiNCのアプリで何を解決したのか ~@izmeal2000 さん資料BFFマイクロサービスの提供する複数API群とクライアントの仲介レイヤー解決できる課題通信パフォーマンス集約ロジックの共有些細な挙動変更であればBFFの修正で対応が可能通信を1本に集約すると別の問題が起こるので、適度な粒度で集約する遅いAPIに引きづられる個別RetryができないBFFの開発はクライアントエンジニアが開発すべきコミュニケーションミスが発生しがちBFFはUIチームによって開発されるものである by　SamNewmanFincは Kotlin + Spring Webflox + protobuf で開発中まとめマイクロサービス,BFF,DDDというキーワードが(当然ですが)何度も出てきました。正直な所、上記のキーワードに対してフワッとした理解しかしていない状況で今回の勉強会に参加させて頂いたので、トークの内容を理解するのに苦労しました。ビジネスロジックの共有という点ではBFFを利用してサーバーサイドで集約するという話がある一方で、懇親会ではReact NativeやKotlin Native, Flutterといった所謂クロスプラットフォーム開発ツールを用いてクライアント側でも集約できないかという議論がありました。確かにサーバーサイドで集約しちゃった方が良いものもありますが、全てがそうではありません。その場合にはiOSはSwift,AndroidはKotlinで同じビジネスロジックを重複実装しなければなりません。クロスプラットフォーム開発ツールを用いてビジネスロジック部分は集約しつつ、UIやプラットフォームに依存するような機能は個別実装できるようになれば、iOS/Androidエンジニア間での認識齟齬も減りコミュニケーションコストの削減にも繋がるなと感じました。但し、現状ではまだまだこれらのツールには課題があり、アプリの規模や導入タイミングによってはデメリットが多くなりそうです。しかしながら、Kotlin NativeはBeta版、FlutterはRC版と今後の開発にも期待ができそうなので、ウォッチしていこうと思います。","link":"https://qiita.com/maguhiro/items/92c4ded090a70f7b6b2e","isoDate":"2018-10-31T03:33:24.000Z","dateMiliSeconds":1540956804000,"authorName":"maguhiro","authorId":"maguhiro"}]},"__N_SSG":true},"page":"/members/[id]","query":{"id":"maguhiro"},"buildId":"FuRxvBA6IZnq6yEH9b4Tj","nextExport":false,"isFallback":false,"gsp":true,"head":[["meta",{"name":"viewport","content":"width=device-width"}],["meta",{"charSet":"utf-8"}],["link",{"rel":"icon shortcut","type":"image/png","href":"https://blog.ubie.tech/logo.png"}],["link",{"rel":"stylesheet","href":"https://fonts.googleapis.com/css2?family=Inter:wght@400;700\u0026display=swap"}],["title",{"children":"maguhiro | Ubie Engineers' Blogs"}],["meta",{"property":"og:title","content":"maguhiro"}],["meta",{"property":"og:url","content":"https://blog.ubie.tech/members/maguhiro"}],["meta",{"name":"twitter:card","content":"summary_large_image"}],["meta",{"property":"og:site","content":"Ubie Engineers' Blogs"}],["meta",{"property":"og:image","content":"https://blog.ubie.tech/og.png"}],["link",{"rel":"canonical","href":"https://blog.ubie.tech/members/maguhiro"}]]}</script><script nomodule="" src="/_next/static/chunks/polyfills-fa276ba060a4a8ac7eef.js"></script><script src="/_next/static/chunks/main-8a83f0fd99327c4684a8.js" async=""></script><script src="/_next/static/chunks/webpack-e067438c4cf4ef2ef178.js" async=""></script><script src="/_next/static/chunks/framework.1daf1ec1ecf144ee9147.js" async=""></script><script src="/_next/static/chunks/commons.8d61253ae98ee51657b8.js" async=""></script><script src="/_next/static/chunks/pages/_app-49079e3278dd6cef7229.js" async=""></script><script src="/_next/static/chunks/81b50c7ab23905e464b4340eb234bd6ea389d26b.f07a62e71140add17478.js" async=""></script><script src="/_next/static/chunks/pages/members/%5Bid%5D-f279413a3daf3c18264d.js" async=""></script><script src="/_next/static/FuRxvBA6IZnq6yEH9b4Tj/_buildManifest.js" async=""></script><script src="/_next/static/FuRxvBA6IZnq6yEH9b4Tj/_ssgManifest.js" async=""></script></body></html>